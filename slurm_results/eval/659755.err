/home/infres/zzhu-24/anaconda3/envs/vlm2vec/lib/python3.10/site-packages/requests/__init__.py:86: RequestsDependencyWarning: Unable to find acceptable character detection dependency (chardet or charset_normalizer).
  warnings.warn(
[2025-11-12 19:32:56,052] DEBUG [git.cmd:1270] Popen(['git', 'version'], cwd=/home/infres/zzhu-24/PRIM/VLM2Vec, stdin=None, shell=False, universal_newlines=False)
[2025-11-12 19:32:56,055] DEBUG [git.cmd:1270] Popen(['git', 'version'], cwd=/home/infres/zzhu-24/PRIM/VLM2Vec, stdin=None, shell=False, universal_newlines=False)
/home/infres/zzhu-24/anaconda3/envs/vlm2vec/lib/python3.10/site-packages/timm/models/layers/__init__.py:48: FutureWarning: Importing from timm.models.layers is deprecated, please import via timm.layers
  warnings.warn(f"Importing from {__name__} is deprecated, please import via timm.layers", FutureWarning)
/home/infres/zzhu-24/PRIM/VLM2Vec/src/model/baseline_backbone/internvideo2/modeling_internvideo2.py:539: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  @torch.cuda.amp.autocast(enabled=False)
[2025-11-12 19:32:56,800] INFO [src.utils:21] Distributed init debug info:
[2025-11-12 19:32:56,800] INFO [src.utils:21] RANK: None
[2025-11-12 19:32:56,801] INFO [src.utils:21] LOCAL_RANK: None
[2025-11-12 19:32:56,801] INFO [src.utils:21] WORLD_SIZE: None
[2025-11-12 19:32:56,801] INFO [src.utils:21] MASTER_ADDR: None
[2025-11-12 19:32:56,801] INFO [src.utils:21] MASTER_PORT: None
[2025-11-12 19:32:57,016] INFO [src.utils:21] Model Backbone: qwen2_vl
[2025-11-12 19:32:57,016] INFO [src.utils:21] Loading processor from: /home/infres/zzhu-24/PRIM/VLM2Vec/experiments/public/exps/train/12Nov_tail_train_only-Qwen/Qwen2-VL-2B-Instruct/checkpoint-500
[2025-11-12 19:32:58,117] INFO [src.utils:21] Loading backbone [qwen2_vl] from /home/infres/zzhu-24/PRIM/VLM2Vec/experiments/public/exps/train/12Nov_tail_train_only-Qwen/Qwen2-VL-2B-Instruct/checkpoint-500
You are attempting to use Flash Attention 2.0 with a model not initialized on GPU. Make sure to move the model to GPU after initializing it on CPU with `model.to('cuda')`.
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:00<00:00,  5.29it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00, 10.21it/s]
[2025-11-12 19:32:58,584] INFO [src.utils:21] Loading LoRA from /home/infres/zzhu-24/PRIM/VLM2Vec/experiments/public/exps/train/12Nov_tail_train_only-Qwen/Qwen2-VL-2B-Instruct/checkpoint-500
[2025-11-12 19:33:08,348] INFO [src.utils:21] Enabling TailTokenWrapper (learnable tail token).
/home/infres/zzhu-24/PRIM/VLM2Vec/src/model/model.py:336: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  tail_embedding = torch.load(os.path.join(model_name_or_path, 'tail_token.pt'))
[2025-11-12 19:33:08,350] INFO [src.utils:21] Qwen2VLForConditionalGeneration(
  (visual): Qwen2VisionTransformerPretrainedModel(
    (patch_embed): PatchEmbed(
      (proj): Conv3d(3, 1280, kernel_size=(2, 14, 14), stride=(2, 14, 14), bias=False)
    )
    (rotary_pos_emb): VisionRotaryEmbedding()
    (blocks): ModuleList(
      (0-31): 32 x Qwen2VLVisionBlock(
        (norm1): LayerNorm((1280,), eps=1e-06, elementwise_affine=True)
        (norm2): LayerNorm((1280,), eps=1e-06, elementwise_affine=True)
        (attn): VisionFlashAttention2(
          (qkv): Linear(in_features=1280, out_features=3840, bias=True)
          (proj): Linear(in_features=1280, out_features=1280, bias=True)
        )
        (mlp): VisionMlp(
          (fc1): Linear(in_features=1280, out_features=5120, bias=True)
          (act): QuickGELUActivation()
          (fc2): Linear(in_features=5120, out_features=1280, bias=True)
        )
      )
    )
    (merger): PatchMerger(
      (ln_q): LayerNorm((1280,), eps=1e-06, elementwise_affine=True)
      (mlp): Sequential(
        (0): Linear(in_features=5120, out_features=5120, bias=True)
        (1): GELU(approximate='none')
        (2): Linear(in_features=5120, out_features=1536, bias=True)
      )
    )
  )
  (model): Qwen2VLModel(
    (embed_tokens): Embedding(151936, 1536)
    (layers): ModuleList(
      (0-27): 28 x Qwen2VLDecoderLayer(
        (self_attn): Qwen2VLFlashAttention2(
          (q_proj): Linear(in_features=1536, out_features=1536, bias=True)
          (k_proj): Linear(in_features=1536, out_features=256, bias=True)
          (v_proj): Linear(in_features=1536, out_features=256, bias=True)
          (o_proj): Linear(in_features=1536, out_features=1536, bias=False)
          (rotary_emb): Qwen2VLRotaryEmbedding()
        )
        (mlp): Qwen2MLP(
          (gate_proj): Linear(in_features=1536, out_features=8960, bias=False)
          (up_proj): Linear(in_features=1536, out_features=8960, bias=False)
          (down_proj): Linear(in_features=8960, out_features=1536, bias=False)
          (act_fn): SiLU()
        )
        (input_layernorm): Qwen2RMSNorm((1536,), eps=1e-06)
        (post_attention_layernorm): Qwen2RMSNorm((1536,), eps=1e-06)
      )
    )
    (norm): Qwen2RMSNorm((1536,), eps=1e-06)
    (rotary_emb): Qwen2VLRotaryEmbedding()
  )
  (lm_head): Linear(in_features=1536, out_features=151936, bias=False)
)
[2025-11-12 19:33:08,352] INFO [src.utils:21] [rank=0] Loading the model from Huggingface: Qwen/Qwen2-VL-2B-Instruct...
[2025-11-12 19:33:08,934] INFO [src.utils:21] --- Evaluating MSCOCO_i2t ---
Map (num_proc=4): 100%|██████████| 1000/1000 [00:00<?, ? examples/s]Map (num_proc=4): 1250 examples [00:00, 518.91 examples/s]          Map (num_proc=4): 1750 examples [00:00, 1487.47 examples/s]Map (num_proc=4): 2000 examples [00:00, 1249.30 examples/s]
[2025-11-12 19:33:12,900] INFO [src.utils:21] Encoding queries...
Queries for MSCOCO_i2t (rank 0):   0%|          | 0/42 [00:00<?, ?it/s]You're using a Qwen2TokenizerFast tokenizer. Please note that with a fast tokenizer, using the `__call__` method is faster than using a method to encode the text followed by a call to the `pad` method to get a padded encoding.
Queries for MSCOCO_i2t (rank 0):   2%|▏         | 1/42 [00:00<00:23,  1.73it/s]Queries for MSCOCO_i2t (rank 0):   5%|▍         | 2/42 [00:00<00:16,  2.42it/s]Queries for MSCOCO_i2t (rank 0):   7%|▋         | 3/42 [00:01<00:13,  2.82it/s]Queries for MSCOCO_i2t (rank 0):  10%|▉         | 4/42 [00:01<00:12,  3.07it/s]Queries for MSCOCO_i2t (rank 0):  12%|█▏        | 5/42 [00:01<00:11,  3.24it/s]Queries for MSCOCO_i2t (rank 0):  14%|█▍        | 6/42 [00:01<00:10,  3.36it/s]Queries for MSCOCO_i2t (rank 0):  17%|█▋        | 7/42 [00:02<00:10,  3.33it/s]Queries for MSCOCO_i2t (rank 0):  19%|█▉        | 8/42 [00:02<00:09,  3.44it/s]Queries for MSCOCO_i2t (rank 0):  21%|██▏       | 9/42 [00:02<00:09,  3.45it/s]Queries for MSCOCO_i2t (rank 0):  24%|██▍       | 10/42 [00:03<00:09,  3.55it/s]Queries for MSCOCO_i2t (rank 0):  26%|██▌       | 11/42 [00:03<00:08,  3.57it/s]Queries for MSCOCO_i2t (rank 0):  29%|██▊       | 12/42 [00:03<00:08,  3.64it/s]Queries for MSCOCO_i2t (rank 0):  31%|███       | 13/42 [00:03<00:08,  3.59it/s]Queries for MSCOCO_i2t (rank 0):  33%|███▎      | 14/42 [00:04<00:07,  3.61it/s]Queries for MSCOCO_i2t (rank 0):  36%|███▌      | 15/42 [00:04<00:07,  3.67it/s]Queries for MSCOCO_i2t (rank 0):  38%|███▊      | 16/42 [00:04<00:07,  3.67it/s]Queries for MSCOCO_i2t (rank 0):  40%|████      | 17/42 [00:05<00:06,  3.64it/s]Queries for MSCOCO_i2t (rank 0):  43%|████▎     | 18/42 [00:05<00:06,  3.48it/s]Queries for MSCOCO_i2t (rank 0):  45%|████▌     | 19/42 [00:05<00:06,  3.48it/s]Queries for MSCOCO_i2t (rank 0):  48%|████▊     | 20/42 [00:05<00:06,  3.53it/s]Queries for MSCOCO_i2t (rank 0):  50%|█████     | 21/42 [00:06<00:06,  3.31it/s]Queries for MSCOCO_i2t (rank 0):  52%|█████▏    | 22/42 [00:06<00:06,  3.18it/s]Queries for MSCOCO_i2t (rank 0):  55%|█████▍    | 23/42 [00:06<00:05,  3.27it/s]Queries for MSCOCO_i2t (rank 0):  57%|█████▋    | 24/42 [00:07<00:05,  3.36it/s]Queries for MSCOCO_i2t (rank 0):  60%|█████▉    | 25/42 [00:07<00:04,  3.44it/s]Queries for MSCOCO_i2t (rank 0):  62%|██████▏   | 26/42 [00:07<00:04,  3.50it/s]Queries for MSCOCO_i2t (rank 0):  64%|██████▍   | 27/42 [00:07<00:04,  3.58it/s]Queries for MSCOCO_i2t (rank 0):  67%|██████▋   | 28/42 [00:08<00:03,  3.63it/s]Queries for MSCOCO_i2t (rank 0):  69%|██████▉   | 29/42 [00:08<00:03,  3.61it/s]Queries for MSCOCO_i2t (rank 0):  71%|███████▏  | 30/42 [00:08<00:03,  3.41it/s]Queries for MSCOCO_i2t (rank 0):  74%|███████▍  | 31/42 [00:09<00:03,  3.45it/s]Queries for MSCOCO_i2t (rank 0):  76%|███████▌  | 32/42 [00:09<00:02,  3.51it/s]Queries for MSCOCO_i2t (rank 0):  79%|███████▊  | 33/42 [00:09<00:02,  3.47it/s]Queries for MSCOCO_i2t (rank 0):  81%|████████  | 34/42 [00:09<00:02,  3.52it/s]Queries for MSCOCO_i2t (rank 0):  83%|████████▎ | 35/42 [00:10<00:01,  3.58it/s]Queries for MSCOCO_i2t (rank 0):  86%|████████▌ | 36/42 [00:10<00:01,  3.59it/s]Queries for MSCOCO_i2t (rank 0):  88%|████████▊ | 37/42 [00:10<00:01,  3.61it/s]Queries for MSCOCO_i2t (rank 0):  90%|█████████ | 38/42 [00:11<00:01,  3.65it/s]Queries for MSCOCO_i2t (rank 0):  93%|█████████▎| 39/42 [00:11<00:00,  3.64it/s]Queries for MSCOCO_i2t (rank 0):  95%|█████████▌| 40/42 [00:11<00:00,  3.62it/s]Queries for MSCOCO_i2t (rank 0):  98%|█████████▊| 41/42 [00:11<00:00,  3.66it/s]Queries for MSCOCO_i2t (rank 0): 100%|██████████| 42/42 [00:12<00:00,  3.99it/s]Queries for MSCOCO_i2t (rank 0): 100%|██████████| 42/42 [00:12<00:00,  3.47it/s]
[2025-11-12 19:33:25,177] INFO [src.utils:21] Saved query embeddings to /home/infres/zzhu-24/PRIM/VLM2Vec/experiments/public/exps/eval_after_train/DEBUG_12Nov_tail_train_only-Qwen/qwen-Qwen2-VL-2B-Instruct/checkpoint-500/layer_28/retrieval/MSCOCO_i2t_qry
[2025-11-12 19:33:25,177] INFO [src.utils:21] Encoding candidates...
Candidates for MSCOCO_i2t (rank 0):   0%|          | 0/207 [00:00<?, ?it/s]Candidates for MSCOCO_i2t (rank 0):   1%|          | 2/207 [00:00<00:14, 14.56it/s]Candidates for MSCOCO_i2t (rank 0):   2%|▏         | 4/207 [00:00<00:13, 14.74it/s]Candidates for MSCOCO_i2t (rank 0):   3%|▎         | 6/207 [00:00<00:13, 14.95it/s]Candidates for MSCOCO_i2t (rank 0):   4%|▍         | 8/207 [00:00<00:13, 14.99it/s]Candidates for MSCOCO_i2t (rank 0):   5%|▍         | 10/207 [00:00<00:12, 15.18it/s]Candidates for MSCOCO_i2t (rank 0):   6%|▌         | 12/207 [00:00<00:12, 15.18it/s]Candidates for MSCOCO_i2t (rank 0):   7%|▋         | 14/207 [00:00<00:13, 14.80it/s]Candidates for MSCOCO_i2t (rank 0):   8%|▊         | 16/207 [00:01<00:13, 14.57it/s]Candidates for MSCOCO_i2t (rank 0):   9%|▊         | 18/207 [00:01<00:13, 14.38it/s]Candidates for MSCOCO_i2t (rank 0):  10%|▉         | 20/207 [00:01<00:13, 14.28it/s]Candidates for MSCOCO_i2t (rank 0):  11%|█         | 22/207 [00:01<00:13, 14.02it/s]Candidates for MSCOCO_i2t (rank 0):  12%|█▏        | 24/207 [00:01<00:12, 14.15it/s]Candidates for MSCOCO_i2t (rank 0):  13%|█▎        | 26/207 [00:01<00:12, 14.18it/s]Candidates for MSCOCO_i2t (rank 0):  14%|█▎        | 28/207 [00:01<00:12, 14.16it/s]Candidates for MSCOCO_i2t (rank 0):  14%|█▍        | 30/207 [00:02<00:12, 14.14it/s]Candidates for MSCOCO_i2t (rank 0):  15%|█▌        | 32/207 [00:02<00:12, 13.96it/s]Candidates for MSCOCO_i2t (rank 0):  16%|█▋        | 34/207 [00:02<00:12, 13.93it/s]Candidates for MSCOCO_i2t (rank 0):  17%|█▋        | 36/207 [00:02<00:12, 13.95it/s]Candidates for MSCOCO_i2t (rank 0):  18%|█▊        | 38/207 [00:02<00:12, 13.86it/s]Candidates for MSCOCO_i2t (rank 0):  19%|█▉        | 40/207 [00:02<00:12, 13.75it/s]Candidates for MSCOCO_i2t (rank 0):  20%|██        | 42/207 [00:02<00:11, 13.98it/s]Candidates for MSCOCO_i2t (rank 0):  21%|██▏       | 44/207 [00:03<00:11, 14.16it/s]Candidates for MSCOCO_i2t (rank 0):  22%|██▏       | 46/207 [00:03<00:11, 14.17it/s]Candidates for MSCOCO_i2t (rank 0):  23%|██▎       | 48/207 [00:03<00:11, 14.11it/s]Candidates for MSCOCO_i2t (rank 0):  24%|██▍       | 50/207 [00:03<00:11, 14.02it/s]Candidates for MSCOCO_i2t (rank 0):  25%|██▌       | 52/207 [00:03<00:11, 14.06it/s]Candidates for MSCOCO_i2t (rank 0):  26%|██▌       | 54/207 [00:03<00:10, 14.20it/s]Candidates for MSCOCO_i2t (rank 0):  27%|██▋       | 56/207 [00:03<00:10, 14.06it/s]Candidates for MSCOCO_i2t (rank 0):  28%|██▊       | 58/207 [00:04<00:10, 14.08it/s]Candidates for MSCOCO_i2t (rank 0):  29%|██▉       | 60/207 [00:04<00:10, 13.78it/s]Candidates for MSCOCO_i2t (rank 0):  30%|██▉       | 62/207 [00:04<00:10, 13.89it/s]Candidates for MSCOCO_i2t (rank 0):  31%|███       | 64/207 [00:04<00:10, 13.96it/s]Candidates for MSCOCO_i2t (rank 0):  32%|███▏      | 66/207 [00:04<00:09, 14.15it/s]Candidates for MSCOCO_i2t (rank 0):  33%|███▎      | 68/207 [00:04<00:09, 14.39it/s]Candidates for MSCOCO_i2t (rank 0):  34%|███▍      | 70/207 [00:04<00:09, 14.34it/s]Candidates for MSCOCO_i2t (rank 0):  35%|███▍      | 72/207 [00:05<00:09, 14.30it/s]Candidates for MSCOCO_i2t (rank 0):  36%|███▌      | 74/207 [00:05<00:09, 14.40it/s]Candidates for MSCOCO_i2t (rank 0):  37%|███▋      | 76/207 [00:05<00:09, 14.40it/s]Candidates for MSCOCO_i2t (rank 0):  38%|███▊      | 78/207 [00:05<00:09, 14.26it/s]Candidates for MSCOCO_i2t (rank 0):  39%|███▊      | 80/207 [00:05<00:09, 14.05it/s]Candidates for MSCOCO_i2t (rank 0):  40%|███▉      | 82/207 [00:05<00:08, 14.18it/s]Candidates for MSCOCO_i2t (rank 0):  41%|████      | 84/207 [00:05<00:08, 14.18it/s]Candidates for MSCOCO_i2t (rank 0):  42%|████▏     | 86/207 [00:06<00:08, 14.30it/s]Candidates for MSCOCO_i2t (rank 0):  43%|████▎     | 88/207 [00:06<00:08, 14.27it/s]Candidates for MSCOCO_i2t (rank 0):  43%|████▎     | 90/207 [00:06<00:08, 14.23it/s]Candidates for MSCOCO_i2t (rank 0):  44%|████▍     | 92/207 [00:06<00:08, 14.32it/s]Candidates for MSCOCO_i2t (rank 0):  45%|████▌     | 94/207 [00:06<00:07, 14.28it/s]Candidates for MSCOCO_i2t (rank 0):  46%|████▋     | 96/207 [00:06<00:07, 14.26it/s]Candidates for MSCOCO_i2t (rank 0):  47%|████▋     | 98/207 [00:06<00:07, 14.24it/s]Candidates for MSCOCO_i2t (rank 0):  48%|████▊     | 100/207 [00:07<00:07, 14.15it/s]Candidates for MSCOCO_i2t (rank 0):  49%|████▉     | 102/207 [00:07<00:07, 14.28it/s]Candidates for MSCOCO_i2t (rank 0):  50%|█████     | 104/207 [00:07<00:07, 14.37it/s]Candidates for MSCOCO_i2t (rank 0):  51%|█████     | 106/207 [00:07<00:07, 14.22it/s]Candidates for MSCOCO_i2t (rank 0):  52%|█████▏    | 108/207 [00:07<00:07, 14.14it/s]Candidates for MSCOCO_i2t (rank 0):  53%|█████▎    | 110/207 [00:07<00:06, 14.16it/s]Candidates for MSCOCO_i2t (rank 0):  54%|█████▍    | 112/207 [00:07<00:06, 14.28it/s]Candidates for MSCOCO_i2t (rank 0):  55%|█████▌    | 114/207 [00:08<00:06, 14.36it/s]Candidates for MSCOCO_i2t (rank 0):  56%|█████▌    | 116/207 [00:08<00:06, 14.31it/s]Candidates for MSCOCO_i2t (rank 0):  57%|█████▋    | 118/207 [00:08<00:06, 14.53it/s]Candidates for MSCOCO_i2t (rank 0):  58%|█████▊    | 120/207 [00:08<00:06, 14.34it/s]Candidates for MSCOCO_i2t (rank 0):  59%|█████▉    | 122/207 [00:08<00:05, 14.31it/s]Candidates for MSCOCO_i2t (rank 0):  60%|█████▉    | 124/207 [00:08<00:05, 14.26it/s]Candidates for MSCOCO_i2t (rank 0):  61%|██████    | 126/207 [00:08<00:05, 14.17it/s]Candidates for MSCOCO_i2t (rank 0):  62%|██████▏   | 128/207 [00:08<00:05, 14.15it/s]Candidates for MSCOCO_i2t (rank 0):  63%|██████▎   | 130/207 [00:09<00:05, 14.16it/s]Candidates for MSCOCO_i2t (rank 0):  64%|██████▍   | 132/207 [00:09<00:05, 14.28it/s]Candidates for MSCOCO_i2t (rank 0):  65%|██████▍   | 134/207 [00:09<00:05, 14.19it/s]Candidates for MSCOCO_i2t (rank 0):  66%|██████▌   | 136/207 [00:09<00:05, 14.19it/s]Candidates for MSCOCO_i2t (rank 0):  67%|██████▋   | 138/207 [00:09<00:04, 14.17it/s]Candidates for MSCOCO_i2t (rank 0):  68%|██████▊   | 140/207 [00:09<00:04, 14.13it/s]Candidates for MSCOCO_i2t (rank 0):  69%|██████▊   | 142/207 [00:09<00:04, 14.26it/s]Candidates for MSCOCO_i2t (rank 0):  70%|██████▉   | 144/207 [00:10<00:04, 14.23it/s]Candidates for MSCOCO_i2t (rank 0):  71%|███████   | 146/207 [00:10<00:04, 14.19it/s]Candidates for MSCOCO_i2t (rank 0):  71%|███████▏  | 148/207 [00:10<00:04, 14.19it/s]Candidates for MSCOCO_i2t (rank 0):  72%|███████▏  | 150/207 [00:10<00:04, 14.18it/s]Candidates for MSCOCO_i2t (rank 0):  73%|███████▎  | 152/207 [00:10<00:03, 14.17it/s]Candidates for MSCOCO_i2t (rank 0):  74%|███████▍  | 154/207 [00:10<00:03, 14.12it/s]Candidates for MSCOCO_i2t (rank 0):  75%|███████▌  | 156/207 [00:10<00:03, 14.09it/s]Candidates for MSCOCO_i2t (rank 0):  76%|███████▋  | 158/207 [00:11<00:03, 14.13it/s]Candidates for MSCOCO_i2t (rank 0):  77%|███████▋  | 160/207 [00:11<00:03, 14.17it/s]Candidates for MSCOCO_i2t (rank 0):  78%|███████▊  | 162/207 [00:11<00:03, 14.18it/s]Candidates for MSCOCO_i2t (rank 0):  79%|███████▉  | 164/207 [00:11<00:03, 14.30it/s]Candidates for MSCOCO_i2t (rank 0):  80%|████████  | 166/207 [00:11<00:02, 14.18it/s]Candidates for MSCOCO_i2t (rank 0):  81%|████████  | 168/207 [00:11<00:02, 14.11it/s]Candidates for MSCOCO_i2t (rank 0):  82%|████████▏ | 170/207 [00:11<00:02, 13.51it/s]Candidates for MSCOCO_i2t (rank 0):  83%|████████▎ | 172/207 [00:12<00:02, 13.66it/s]Candidates for MSCOCO_i2t (rank 0):  84%|████████▍ | 174/207 [00:12<00:02, 13.82it/s]Candidates for MSCOCO_i2t (rank 0):  85%|████████▌ | 176/207 [00:12<00:02, 13.83it/s]Candidates for MSCOCO_i2t (rank 0):  86%|████████▌ | 178/207 [00:12<00:02, 14.01it/s]Candidates for MSCOCO_i2t (rank 0):  87%|████████▋ | 180/207 [00:12<00:01, 14.20it/s]Candidates for MSCOCO_i2t (rank 0):  88%|████████▊ | 182/207 [00:12<00:01, 14.30it/s]Candidates for MSCOCO_i2t (rank 0):  89%|████████▉ | 184/207 [00:12<00:01, 14.25it/s]Candidates for MSCOCO_i2t (rank 0):  90%|████████▉ | 186/207 [00:13<00:01, 14.24it/s]Candidates for MSCOCO_i2t (rank 0):  91%|█████████ | 188/207 [00:13<00:01, 14.33it/s]Candidates for MSCOCO_i2t (rank 0):  92%|█████████▏| 190/207 [00:13<00:01, 14.13it/s]Candidates for MSCOCO_i2t (rank 0):  93%|█████████▎| 192/207 [00:13<00:01, 14.08it/s]Candidates for MSCOCO_i2t (rank 0):  94%|█████████▎| 194/207 [00:13<00:00, 14.11it/s]Candidates for MSCOCO_i2t (rank 0):  95%|█████████▍| 196/207 [00:13<00:00, 14.05it/s]Candidates for MSCOCO_i2t (rank 0):  96%|█████████▌| 198/207 [00:13<00:00, 14.02it/s]Candidates for MSCOCO_i2t (rank 0):  97%|█████████▋| 200/207 [00:14<00:00, 14.08it/s]Candidates for MSCOCO_i2t (rank 0):  98%|█████████▊| 202/207 [00:14<00:00, 14.17it/s]Candidates for MSCOCO_i2t (rank 0):  99%|█████████▊| 204/207 [00:14<00:00, 14.17it/s]Candidates for MSCOCO_i2t (rank 0): 100%|█████████▉| 206/207 [00:14<00:00, 14.21it/s]Candidates for MSCOCO_i2t (rank 0): 100%|██████████| 207/207 [00:14<00:00, 14.19it/s]
[2025-11-12 19:33:39,817] INFO [src.utils:21] Saved candidate embeddings to /home/infres/zzhu-24/PRIM/VLM2Vec/experiments/public/exps/eval_after_train/DEBUG_12Nov_tail_train_only-Qwen/qwen-Qwen2-VL-2B-Instruct/checkpoint-500/layer_28/retrieval/MSCOCO_i2t_tgt
Calculating scores for MSCOCO_i2t: 0it [00:00, ?it/s]Calculating scores for MSCOCO_i2t: 53it [00:00, 516.46it/s]Calculating scores for MSCOCO_i2t: 105it [00:00, 409.61it/s]Calculating scores for MSCOCO_i2t: 161it [00:00, 467.81it/s]Calculating scores for MSCOCO_i2t: 216it [00:00, 496.06it/s]Calculating scores for MSCOCO_i2t: 270it [00:00, 508.64it/s]Calculating scores for MSCOCO_i2t: 322it [00:00, 499.61it/s]Calculating scores for MSCOCO_i2t: 375it [00:00, 508.95it/s]Calculating scores for MSCOCO_i2t: 429it [00:00, 515.81it/s]Calculating scores for MSCOCO_i2t: 483it [00:00, 521.48it/s]Calculating scores for MSCOCO_i2t: 536it [00:01, 515.57it/s]Calculating scores for MSCOCO_i2t: 590it [00:01, 520.30it/s]Calculating scores for MSCOCO_i2t: 644it [00:01, 523.29it/s]Calculating scores for MSCOCO_i2t: 698it [00:01, 525.69it/s]Calculating scores for MSCOCO_i2t: 751it [00:01, 518.42it/s]Calculating scores for MSCOCO_i2t: 805it [00:01, 524.39it/s]Calculating scores for MSCOCO_i2t: 861it [00:01, 534.77it/s]Calculating scores for MSCOCO_i2t: 918it [00:01, 543.03it/s]Calculating scores for MSCOCO_i2t: 973it [00:01, 533.64it/s]Calculating scores for MSCOCO_i2t: 1000it [00:01, 515.94it/s]
[2025-11-12 19:33:42,101] INFO [src.utils:21] Score of MSCOCO_i2t:
[2025-11-12 19:33:42,102] INFO [src.utils:21] {'hit@1': '0.0000', 'hit@5': '0.0050', 'hit@10': '0.0090', 'ndcg_linear@1': '0.0000', 'ndcg_linear@5': '0.0024', 'ndcg_linear@10': '0.0036', 'ndcg_exponential@1': '0.0000', 'ndcg_exponential@5': '0.0024', 'ndcg_exponential@10': '0.0036', 'precision@1': '0.0000', 'precision@5': '0.0010', 'precision@10': '0.0009', 'recall@1': '0.0000', 'recall@5': '0.0050', 'recall@10': '0.0090', 'f1@1': '0.0000', 'f1@5': '0.0017', 'f1@10': '0.0016', 'map@1': '0.0000', 'map@5': '0.0016', 'map@10': '0.0020', 'mrr@1': '0.0000', 'mrr@5': '0.0016', 'mrr@10': '0.0020'}
[2025-11-12 19:33:42,102] INFO [src.utils:21] Outputting final score to: /home/infres/zzhu-24/PRIM/VLM2Vec/experiments/public/exps/eval_after_train/DEBUG_12Nov_tail_train_only-Qwen/qwen-Qwen2-VL-2B-Instruct/checkpoint-500/layer_28/retrieval/MSCOCO_i2t_score.json
[2025-11-12 19:33:42,309] INFO [src.utils:21] --- Evaluating MSCOCO_t2i ---
Map (num_proc=4): 100%|██████████| 1000/1000 [00:00<?, ? examples/s]Map (num_proc=4): 1250 examples [00:02, 97.51 examples/s]           Map (num_proc=4): 2000 examples [00:02, 463.94 examples/s]Map (num_proc=4): 2000 examples [00:03, 328.44 examples/s]
[2025-11-12 19:33:56,739] INFO [src.utils:21] Encoding queries...
Queries for MSCOCO_t2i (rank 0):   0%|          | 0/42 [00:00<?, ?it/s]Queries for MSCOCO_t2i (rank 0):   2%|▏         | 1/42 [00:00<00:17,  2.32it/s]Queries for MSCOCO_t2i (rank 0):   5%|▍         | 2/42 [00:00<00:12,  3.18it/s]Queries for MSCOCO_t2i (rank 0):   7%|▋         | 3/42 [00:01<00:13,  2.80it/s]Queries for MSCOCO_t2i (rank 0):  10%|▉         | 4/42 [00:01<00:14,  2.61it/s]Queries for MSCOCO_t2i (rank 0):  12%|█▏        | 5/42 [00:01<00:12,  3.04it/s]Queries for MSCOCO_t2i (rank 0):  14%|█▍        | 6/42 [00:02<00:12,  2.79it/s]Queries for MSCOCO_t2i (rank 0):  17%|█▋        | 7/42 [00:02<00:11,  3.14it/s]Queries for MSCOCO_t2i (rank 0):  19%|█▉        | 8/42 [00:02<00:11,  2.88it/s]Queries for MSCOCO_t2i (rank 0):  21%|██▏       | 9/42 [00:03<00:12,  2.73it/s]Queries for MSCOCO_t2i (rank 0):  24%|██▍       | 10/42 [00:03<00:10,  3.08it/s]Queries for MSCOCO_t2i (rank 0):  26%|██▌       | 11/42 [00:03<00:10,  2.85it/s]Queries for MSCOCO_t2i (rank 0):  29%|██▊       | 12/42 [00:04<00:11,  2.69it/s]Queries for MSCOCO_t2i (rank 0):  31%|███       | 13/42 [00:04<00:09,  3.03it/s]Queries for MSCOCO_t2i (rank 0):  33%|███▎      | 14/42 [00:04<00:10,  2.80it/s]Queries for MSCOCO_t2i (rank 0):  36%|███▌      | 15/42 [00:05<00:08,  3.13it/s]Queries for MSCOCO_t2i (rank 0):  38%|███▊      | 16/42 [00:05<00:09,  2.88it/s]Queries for MSCOCO_t2i (rank 0):  40%|████      | 17/42 [00:05<00:09,  2.72it/s]Queries for MSCOCO_t2i (rank 0):  43%|████▎     | 18/42 [00:06<00:07,  3.04it/s]Queries for MSCOCO_t2i (rank 0):  45%|████▌     | 19/42 [00:06<00:08,  2.83it/s]Queries for MSCOCO_t2i (rank 0):  48%|████▊     | 20/42 [00:07<00:08,  2.68it/s]Queries for MSCOCO_t2i (rank 0):  50%|█████     | 21/42 [00:07<00:06,  3.02it/s]Queries for MSCOCO_t2i (rank 0):  52%|█████▏    | 22/42 [00:07<00:07,  2.71it/s]Queries for MSCOCO_t2i (rank 0):  55%|█████▍    | 23/42 [00:08<00:07,  2.48it/s]Queries for MSCOCO_t2i (rank 0):  57%|█████▋    | 24/42 [00:08<00:06,  2.83it/s]Queries for MSCOCO_t2i (rank 0):  60%|█████▉    | 25/42 [00:08<00:06,  2.63it/s]Queries for MSCOCO_t2i (rank 0):  62%|██████▏   | 26/42 [00:09<00:06,  2.56it/s]Queries for MSCOCO_t2i (rank 0):  64%|██████▍   | 27/42 [00:09<00:05,  2.90it/s]Queries for MSCOCO_t2i (rank 0):  67%|██████▋   | 28/42 [00:09<00:05,  2.67it/s]Queries for MSCOCO_t2i (rank 0):  69%|██████▉   | 29/42 [00:10<00:04,  3.00it/s]Queries for MSCOCO_t2i (rank 0):  71%|███████▏  | 30/42 [00:10<00:04,  2.79it/s]Queries for MSCOCO_t2i (rank 0):  74%|███████▍  | 31/42 [00:11<00:04,  2.63it/s]Queries for MSCOCO_t2i (rank 0):  76%|███████▌  | 32/42 [00:11<00:03,  2.98it/s]Queries for MSCOCO_t2i (rank 0):  79%|███████▊  | 33/42 [00:11<00:03,  2.77it/s]Queries for MSCOCO_t2i (rank 0):  81%|████████  | 34/42 [00:12<00:03,  2.63it/s]Queries for MSCOCO_t2i (rank 0):  83%|████████▎ | 35/42 [00:12<00:02,  2.96it/s]Queries for MSCOCO_t2i (rank 0):  86%|████████▌ | 36/42 [00:12<00:02,  2.66it/s]Queries for MSCOCO_t2i (rank 0):  88%|████████▊ | 37/42 [00:13<00:01,  3.01it/s]Queries for MSCOCO_t2i (rank 0):  90%|█████████ | 38/42 [00:13<00:01,  2.73it/s]Queries for MSCOCO_t2i (rank 0):  93%|█████████▎| 39/42 [00:13<00:01,  2.58it/s]Queries for MSCOCO_t2i (rank 0):  95%|█████████▌| 40/42 [00:14<00:00,  2.93it/s]Queries for MSCOCO_t2i (rank 0):  98%|█████████▊| 41/42 [00:14<00:00,  2.74it/s]Queries for MSCOCO_t2i (rank 0): 100%|██████████| 42/42 [00:14<00:00,  3.26it/s]Queries for MSCOCO_t2i (rank 0): 100%|██████████| 42/42 [00:14<00:00,  2.84it/s]
[2025-11-12 19:34:11,686] INFO [src.utils:21] Saved query embeddings to /home/infres/zzhu-24/PRIM/VLM2Vec/experiments/public/exps/eval_after_train/DEBUG_12Nov_tail_train_only-Qwen/qwen-Qwen2-VL-2B-Instruct/checkpoint-500/layer_28/retrieval/MSCOCO_t2i_qry
[2025-11-12 19:34:11,686] INFO [src.utils:21] Encoding candidates...
Candidates for MSCOCO_t2i (rank 0):   0%|          | 0/42 [00:00<?, ?it/s]Candidates for MSCOCO_t2i (rank 0):   2%|▏         | 1/42 [00:00<00:13,  3.15it/s]Candidates for MSCOCO_t2i (rank 0):   5%|▍         | 2/42 [00:00<00:12,  3.18it/s]Candidates for MSCOCO_t2i (rank 0):   7%|▋         | 3/42 [00:00<00:11,  3.53it/s]Candidates for MSCOCO_t2i (rank 0):  10%|▉         | 4/42 [00:01<00:11,  3.40it/s]Candidates for MSCOCO_t2i (rank 0):  12%|█▏        | 5/42 [00:01<00:10,  3.61it/s]Candidates for MSCOCO_t2i (rank 0):  14%|█▍        | 6/42 [00:01<00:09,  3.69it/s]Candidates for MSCOCO_t2i (rank 0):  17%|█▋        | 7/42 [00:01<00:09,  3.72it/s]Candidates for MSCOCO_t2i (rank 0):  19%|█▉        | 8/42 [00:02<00:08,  3.78it/s]Candidates for MSCOCO_t2i (rank 0):  21%|██▏       | 9/42 [00:02<00:08,  3.86it/s]Candidates for MSCOCO_t2i (rank 0):  24%|██▍       | 10/42 [00:02<00:08,  3.89it/s]Candidates for MSCOCO_t2i (rank 0):  26%|██▌       | 11/42 [00:02<00:07,  3.96it/s]Candidates for MSCOCO_t2i (rank 0):  29%|██▊       | 12/42 [00:03<00:07,  4.06it/s]Candidates for MSCOCO_t2i (rank 0):  31%|███       | 13/42 [00:03<00:07,  4.08it/s]Candidates for MSCOCO_t2i (rank 0):  33%|███▎      | 14/42 [00:03<00:06,  4.16it/s]Candidates for MSCOCO_t2i (rank 0):  36%|███▌      | 15/42 [00:03<00:06,  4.08it/s]Candidates for MSCOCO_t2i (rank 0):  38%|███▊      | 16/42 [00:04<00:06,  4.15it/s]Candidates for MSCOCO_t2i (rank 0):  40%|████      | 17/42 [00:04<00:06,  4.13it/s]Candidates for MSCOCO_t2i (rank 0):  43%|████▎     | 18/42 [00:04<00:05,  4.16it/s]Candidates for MSCOCO_t2i (rank 0):  45%|████▌     | 19/42 [00:04<00:05,  4.16it/s]Candidates for MSCOCO_t2i (rank 0):  48%|████▊     | 20/42 [00:05<00:05,  4.12it/s]Candidates for MSCOCO_t2i (rank 0):  50%|█████     | 21/42 [00:05<00:05,  4.18it/s]Candidates for MSCOCO_t2i (rank 0):  52%|█████▏    | 22/42 [00:05<00:04,  4.16it/s]Candidates for MSCOCO_t2i (rank 0):  55%|█████▍    | 23/42 [00:05<00:04,  4.06it/s]Candidates for MSCOCO_t2i (rank 0):  57%|█████▋    | 24/42 [00:06<00:04,  3.81it/s]Candidates for MSCOCO_t2i (rank 0):  60%|█████▉    | 25/42 [00:06<00:04,  3.86it/s]Candidates for MSCOCO_t2i (rank 0):  62%|██████▏   | 26/42 [00:06<00:03,  4.00it/s]Candidates for MSCOCO_t2i (rank 0):  64%|██████▍   | 27/42 [00:06<00:03,  4.05it/s]Candidates for MSCOCO_t2i (rank 0):  67%|██████▋   | 28/42 [00:07<00:03,  4.05it/s]Candidates for MSCOCO_t2i (rank 0):  69%|██████▉   | 29/42 [00:07<00:03,  3.96it/s]Candidates for MSCOCO_t2i (rank 0):  71%|███████▏  | 30/42 [00:07<00:03,  3.87it/s]Candidates for MSCOCO_t2i (rank 0):  74%|███████▍  | 31/42 [00:07<00:02,  3.98it/s]Candidates for MSCOCO_t2i (rank 0):  76%|███████▌  | 32/42 [00:08<00:02,  4.04it/s]Candidates for MSCOCO_t2i (rank 0):  79%|███████▊  | 33/42 [00:08<00:02,  4.10it/s]Candidates for MSCOCO_t2i (rank 0):  81%|████████  | 34/42 [00:08<00:01,  4.08it/s]Candidates for MSCOCO_t2i (rank 0):  83%|████████▎ | 35/42 [00:08<00:01,  4.10it/s]Candidates for MSCOCO_t2i (rank 0):  86%|████████▌ | 36/42 [00:09<00:01,  4.00it/s]Candidates for MSCOCO_t2i (rank 0):  88%|████████▊ | 37/42 [00:09<00:01,  3.96it/s]Candidates for MSCOCO_t2i (rank 0):  90%|█████████ | 38/42 [00:09<00:01,  3.94it/s]Candidates for MSCOCO_t2i (rank 0):  93%|█████████▎| 39/42 [00:09<00:00,  3.97it/s]Candidates for MSCOCO_t2i (rank 0):  95%|█████████▌| 40/42 [00:10<00:00,  3.74it/s]Candidates for MSCOCO_t2i (rank 0):  98%|█████████▊| 41/42 [00:10<00:00,  3.85it/s]Candidates for MSCOCO_t2i (rank 0): 100%|██████████| 42/42 [00:10<00:00,  4.07it/s]Candidates for MSCOCO_t2i (rank 0): 100%|██████████| 42/42 [00:10<00:00,  3.95it/s]
[2025-11-12 19:34:22,345] INFO [src.utils:21] Saved candidate embeddings to /home/infres/zzhu-24/PRIM/VLM2Vec/experiments/public/exps/eval_after_train/DEBUG_12Nov_tail_train_only-Qwen/qwen-Qwen2-VL-2B-Instruct/checkpoint-500/layer_28/retrieval/MSCOCO_t2i_tgt
Calculating scores for MSCOCO_t2i: 0it [00:00, ?it/s]Calculating scores for MSCOCO_t2i: 71it [00:00, 705.92it/s]Calculating scores for MSCOCO_t2i: 142it [00:00, 478.59it/s]Calculating scores for MSCOCO_t2i: 201it [00:00, 518.16it/s]Calculating scores for MSCOCO_t2i: 258it [00:00, 533.56it/s]Calculating scores for MSCOCO_t2i: 315it [00:00, 543.95it/s]Calculating scores for MSCOCO_t2i: 380it [00:00, 574.76it/s]Calculating scores for MSCOCO_t2i: 443it [00:00, 589.47it/s]Calculating scores for MSCOCO_t2i: 505it [00:00, 598.29it/s]Calculating scores for MSCOCO_t2i: 566it [00:01, 565.33it/s]Calculating scores for MSCOCO_t2i: 629it [00:01, 581.76it/s]Calculating scores for MSCOCO_t2i: 691it [00:01, 591.39it/s]Calculating scores for MSCOCO_t2i: 751it [00:01, 591.23it/s]Calculating scores for MSCOCO_t2i: 813it [00:01, 599.51it/s]Calculating scores for MSCOCO_t2i: 875it [00:01, 605.37it/s]Calculating scores for MSCOCO_t2i: 937it [00:01, 609.19it/s]Calculating scores for MSCOCO_t2i: 999it [00:01, 602.92it/s]Calculating scores for MSCOCO_t2i: 1000it [00:01, 581.17it/s]
[2025-11-12 19:34:24,393] INFO [src.utils:21] Score of MSCOCO_t2i:
[2025-11-12 19:34:24,393] INFO [src.utils:21] {'hit@1': '0.0030', 'hit@5': '0.0110', 'hit@10': '0.0150', 'ndcg_linear@1': '0.0030', 'ndcg_linear@5': '0.0071', 'ndcg_linear@10': '0.0083', 'ndcg_exponential@1': '0.0030', 'ndcg_exponential@5': '0.0071', 'ndcg_exponential@10': '0.0083', 'precision@1': '0.0030', 'precision@5': '0.0022', 'precision@10': '0.0015', 'recall@1': '0.0030', 'recall@5': '0.0110', 'recall@10': '0.0150', 'f1@1': '0.0030', 'f1@5': '0.0037', 'f1@10': '0.0027', 'map@1': '0.0030', 'map@5': '0.0058', 'map@10': '0.0063', 'mrr@1': '0.0030', 'mrr@5': '0.0058', 'mrr@10': '0.0063'}
[2025-11-12 19:34:24,393] INFO [src.utils:21] Outputting final score to: /home/infres/zzhu-24/PRIM/VLM2Vec/experiments/public/exps/eval_after_train/DEBUG_12Nov_tail_train_only-Qwen/qwen-Qwen2-VL-2B-Instruct/checkpoint-500/layer_28/retrieval/MSCOCO_t2i_score.json
[2025-11-12 19:34:24,553] INFO [src.utils:21] --- Evaluating FashionIQ ---
Map (num_proc=4): 100%|██████████| 1000/1000 [00:00<?, ? examples/s]Map (num_proc=4): 1250 examples [00:02, 112.72 examples/s]          Map (num_proc=4): 2000 examples [00:02, 492.67 examples/s]Map (num_proc=4): 2000 examples [00:02, 364.61 examples/s]
[2025-11-12 19:34:39,112] INFO [src.utils:21] Encoding queries...
Queries for FashionIQ (rank 0):   0%|          | 0/42 [00:00<?, ?it/s]Queries for FashionIQ (rank 0):   2%|▏         | 1/42 [00:00<00:20,  1.99it/s]Queries for FashionIQ (rank 0):   5%|▍         | 2/42 [00:01<00:23,  1.69it/s]Queries for FashionIQ (rank 0):   7%|▋         | 3/42 [00:01<00:23,  1.63it/s]Queries for FashionIQ (rank 0):  10%|▉         | 4/42 [00:02<00:21,  1.80it/s]Queries for FashionIQ (rank 0):  12%|█▏        | 5/42 [00:02<00:21,  1.71it/s]Queries for FashionIQ (rank 0):  14%|█▍        | 6/42 [00:03<00:21,  1.69it/s]Queries for FashionIQ (rank 0):  17%|█▋        | 7/42 [00:03<00:19,  1.84it/s]Queries for FashionIQ (rank 0):  19%|█▉        | 8/42 [00:04<00:19,  1.79it/s]Queries for FashionIQ (rank 0):  21%|██▏       | 9/42 [00:05<00:19,  1.72it/s]Queries for FashionIQ (rank 0):  24%|██▍       | 10/42 [00:05<00:18,  1.78it/s]Queries for FashionIQ (rank 0):  26%|██▌       | 11/42 [00:06<00:17,  1.76it/s]Queries for FashionIQ (rank 0):  29%|██▊       | 12/42 [00:06<00:17,  1.72it/s]Queries for FashionIQ (rank 0):  31%|███       | 13/42 [00:07<00:15,  1.86it/s]Queries for FashionIQ (rank 0):  33%|███▎      | 14/42 [00:07<00:15,  1.75it/s]Queries for FashionIQ (rank 0):  36%|███▌      | 15/42 [00:08<00:15,  1.69it/s]Queries for FashionIQ (rank 0):  38%|███▊      | 16/42 [00:09<00:14,  1.82it/s]Queries for FashionIQ (rank 0):  40%|████      | 17/42 [00:09<00:14,  1.68it/s]Queries for FashionIQ (rank 0):  43%|████▎     | 18/42 [00:10<00:14,  1.69it/s]Queries for FashionIQ (rank 0):  45%|████▌     | 19/42 [00:10<00:12,  1.79it/s]Queries for FashionIQ (rank 0):  48%|████▊     | 20/42 [00:11<00:12,  1.70it/s]Queries for FashionIQ (rank 0):  50%|█████     | 21/42 [00:12<00:12,  1.66it/s]Queries for FashionIQ (rank 0):  52%|█████▏    | 22/42 [00:12<00:11,  1.82it/s]Queries for FashionIQ (rank 0):  55%|█████▍    | 23/42 [00:13<00:11,  1.72it/s]Queries for FashionIQ (rank 0):  57%|█████▋    | 24/42 [00:13<00:10,  1.71it/s]Queries for FashionIQ (rank 0):  60%|█████▉    | 25/42 [00:14<00:09,  1.85it/s]Queries for FashionIQ (rank 0):  62%|██████▏   | 26/42 [00:14<00:09,  1.68it/s]Queries for FashionIQ (rank 0):  64%|██████▍   | 27/42 [00:15<00:09,  1.63it/s]Queries for FashionIQ (rank 0):  67%|██████▋   | 28/42 [00:16<00:08,  1.73it/s]Queries for FashionIQ (rank 0):  69%|██████▉   | 29/42 [00:16<00:07,  1.64it/s]Queries for FashionIQ (rank 0):  71%|███████▏  | 30/42 [00:17<00:06,  1.80it/s]Queries for FashionIQ (rank 0):  74%|███████▍  | 31/42 [00:17<00:06,  1.75it/s]Queries for FashionIQ (rank 0):  76%|███████▌  | 32/42 [00:18<00:06,  1.66it/s]Queries for FashionIQ (rank 0):  79%|███████▊  | 33/42 [00:18<00:04,  1.84it/s]Queries for FashionIQ (rank 0):  81%|████████  | 34/42 [00:19<00:04,  1.70it/s]Queries for FashionIQ (rank 0):  83%|████████▎ | 35/42 [00:20<00:03,  1.85it/s]Queries for FashionIQ (rank 0):  86%|████████▌ | 36/42 [00:20<00:03,  1.76it/s]Queries for FashionIQ (rank 0):  88%|████████▊ | 37/42 [00:21<00:02,  1.72it/s]Queries for FashionIQ (rank 0):  90%|█████████ | 38/42 [00:21<00:02,  1.90it/s]Queries for FashionIQ (rank 0):  93%|█████████▎| 39/42 [00:22<00:01,  1.75it/s]Queries for FashionIQ (rank 0):  95%|█████████▌| 40/42 [00:22<00:01,  1.71it/s]Queries for FashionIQ (rank 0):  98%|█████████▊| 41/42 [00:23<00:00,  1.88it/s]Queries for FashionIQ (rank 0): 100%|██████████| 42/42 [00:23<00:00,  1.95it/s]Queries for FashionIQ (rank 0): 100%|██████████| 42/42 [00:23<00:00,  1.76it/s]
[2025-11-12 19:35:03,087] INFO [src.utils:21] Saved query embeddings to /home/infres/zzhu-24/PRIM/VLM2Vec/experiments/public/exps/eval_after_train/DEBUG_12Nov_tail_train_only-Qwen/qwen-Qwen2-VL-2B-Instruct/checkpoint-500/layer_28/retrieval/FashionIQ_qry
[2025-11-12 19:35:03,087] INFO [src.utils:21] Encoding candidates...
Candidates for FashionIQ (rank 0):   0%|          | 0/250 [00:00<?, ?it/s]Candidates for FashionIQ (rank 0):   0%|          | 1/250 [00:00<01:03,  3.90it/s]Candidates for FashionIQ (rank 0):   1%|          | 2/250 [00:00<00:58,  4.27it/s]Candidates for FashionIQ (rank 0):   1%|          | 3/250 [00:00<00:58,  4.24it/s]Candidates for FashionIQ (rank 0):   2%|▏         | 4/250 [00:00<00:57,  4.25it/s]Candidates for FashionIQ (rank 0):   2%|▏         | 5/250 [00:01<00:58,  4.19it/s]Candidates for FashionIQ (rank 0):   2%|▏         | 6/250 [00:01<00:57,  4.25it/s]Candidates for FashionIQ (rank 0):   3%|▎         | 7/250 [00:01<01:02,  3.90it/s]Candidates for FashionIQ (rank 0):   3%|▎         | 8/250 [00:01<01:01,  3.94it/s]Candidates for FashionIQ (rank 0):   4%|▎         | 9/250 [00:02<00:58,  4.09it/s]Candidates for FashionIQ (rank 0):   4%|▍         | 10/250 [00:02<00:59,  4.02it/s]Candidates for FashionIQ (rank 0):   4%|▍         | 11/250 [00:02<00:59,  4.00it/s]Candidates for FashionIQ (rank 0):   5%|▍         | 12/250 [00:02<00:59,  3.99it/s]Candidates for FashionIQ (rank 0):   5%|▌         | 13/250 [00:03<01:01,  3.86it/s]Candidates for FashionIQ (rank 0):   6%|▌         | 14/250 [00:03<01:00,  3.90it/s]Candidates for FashionIQ (rank 0):   6%|▌         | 15/250 [00:03<01:02,  3.74it/s]Candidates for FashionIQ (rank 0):   6%|▋         | 16/250 [00:04<01:04,  3.60it/s]Candidates for FashionIQ (rank 0):   7%|▋         | 17/250 [00:04<01:02,  3.70it/s]Candidates for FashionIQ (rank 0):   7%|▋         | 18/250 [00:04<01:00,  3.83it/s]Candidates for FashionIQ (rank 0):   8%|▊         | 19/250 [00:04<01:00,  3.81it/s]Candidates for FashionIQ (rank 0):   8%|▊         | 20/250 [00:05<01:00,  3.77it/s]Candidates for FashionIQ (rank 0):   8%|▊         | 21/250 [00:05<00:59,  3.88it/s]Candidates for FashionIQ (rank 0):   9%|▉         | 22/250 [00:05<00:56,  4.03it/s]Candidates for FashionIQ (rank 0):   9%|▉         | 23/250 [00:05<00:56,  4.02it/s]Candidates for FashionIQ (rank 0):  10%|▉         | 24/250 [00:06<00:57,  3.91it/s]Candidates for FashionIQ (rank 0):  10%|█         | 25/250 [00:06<00:55,  4.08it/s]Candidates for FashionIQ (rank 0):  10%|█         | 26/250 [00:06<00:53,  4.19it/s]Candidates for FashionIQ (rank 0):  11%|█         | 27/250 [00:06<00:52,  4.24it/s]Candidates for FashionIQ (rank 0):  11%|█         | 28/250 [00:07<00:54,  4.11it/s]Candidates for FashionIQ (rank 0):  12%|█▏        | 29/250 [00:07<00:55,  3.99it/s]Candidates for FashionIQ (rank 0):  12%|█▏        | 30/250 [00:07<00:55,  3.97it/s]Candidates for FashionIQ (rank 0):  12%|█▏        | 31/250 [00:07<00:55,  3.95it/s]Candidates for FashionIQ (rank 0):  13%|█▎        | 32/250 [00:08<00:56,  3.86it/s]Candidates for FashionIQ (rank 0):  13%|█▎        | 33/250 [00:08<00:54,  3.96it/s]Candidates for FashionIQ (rank 0):  14%|█▎        | 34/250 [00:08<00:54,  3.93it/s]Candidates for FashionIQ (rank 0):  14%|█▍        | 35/250 [00:08<00:54,  3.95it/s]Candidates for FashionIQ (rank 0):  14%|█▍        | 36/250 [00:09<00:55,  3.87it/s]Candidates for FashionIQ (rank 0):  15%|█▍        | 37/250 [00:09<00:54,  3.90it/s]Candidates for FashionIQ (rank 0):  15%|█▌        | 38/250 [00:09<00:52,  4.01it/s]Candidates for FashionIQ (rank 0):  16%|█▌        | 39/250 [00:09<00:50,  4.16it/s]Candidates for FashionIQ (rank 0):  16%|█▌        | 40/250 [00:10<00:49,  4.21it/s]Candidates for FashionIQ (rank 0):  16%|█▋        | 41/250 [00:10<00:52,  3.98it/s]Candidates for FashionIQ (rank 0):  17%|█▋        | 42/250 [00:10<00:52,  3.98it/s]Candidates for FashionIQ (rank 0):  17%|█▋        | 43/250 [00:10<00:50,  4.08it/s]Candidates for FashionIQ (rank 0):  18%|█▊        | 44/250 [00:11<00:49,  4.18it/s]Candidates for FashionIQ (rank 0):  18%|█▊        | 45/250 [00:11<00:49,  4.17it/s]Candidates for FashionIQ (rank 0):  18%|█▊        | 46/250 [00:11<00:52,  3.91it/s]Candidates for FashionIQ (rank 0):  19%|█▉        | 47/250 [00:11<00:49,  4.07it/s]Candidates for FashionIQ (rank 0):  19%|█▉        | 48/250 [00:12<00:49,  4.04it/s]Candidates for FashionIQ (rank 0):  20%|█▉        | 49/250 [00:12<00:49,  4.08it/s]Candidates for FashionIQ (rank 0):  20%|██        | 50/250 [00:12<00:47,  4.19it/s]Candidates for FashionIQ (rank 0):  20%|██        | 51/250 [00:12<00:49,  3.99it/s]Candidates for FashionIQ (rank 0):  21%|██        | 52/250 [00:13<00:49,  4.00it/s]Candidates for FashionIQ (rank 0):  21%|██        | 53/250 [00:13<00:49,  3.96it/s]Candidates for FashionIQ (rank 0):  22%|██▏       | 54/250 [00:13<00:48,  4.01it/s]Candidates for FashionIQ (rank 0):  22%|██▏       | 55/250 [00:13<00:47,  4.14it/s]Candidates for FashionIQ (rank 0):  22%|██▏       | 56/250 [00:13<00:46,  4.13it/s]Candidates for FashionIQ (rank 0):  23%|██▎       | 57/250 [00:14<00:48,  4.01it/s]Candidates for FashionIQ (rank 0):  23%|██▎       | 58/250 [00:14<00:46,  4.09it/s]Candidates for FashionIQ (rank 0):  24%|██▎       | 59/250 [00:14<00:45,  4.18it/s]Candidates for FashionIQ (rank 0):  24%|██▍       | 60/250 [00:14<00:45,  4.15it/s]Candidates for FashionIQ (rank 0):  24%|██▍       | 61/250 [00:15<00:44,  4.23it/s]Candidates for FashionIQ (rank 0):  25%|██▍       | 62/250 [00:15<00:45,  4.11it/s]Candidates for FashionIQ (rank 0):  25%|██▌       | 63/250 [00:15<00:46,  4.00it/s]Candidates for FashionIQ (rank 0):  26%|██▌       | 64/250 [00:15<00:45,  4.10it/s]Candidates for FashionIQ (rank 0):  26%|██▌       | 65/250 [00:16<00:45,  4.11it/s]Candidates for FashionIQ (rank 0):  26%|██▋       | 66/250 [00:16<00:44,  4.18it/s]Candidates for FashionIQ (rank 0):  27%|██▋       | 67/250 [00:16<00:44,  4.14it/s]Candidates for FashionIQ (rank 0):  27%|██▋       | 68/250 [00:16<00:45,  4.02it/s]Candidates for FashionIQ (rank 0):  28%|██▊       | 69/250 [00:17<00:46,  3.93it/s]Candidates for FashionIQ (rank 0):  28%|██▊       | 70/250 [00:17<00:45,  3.96it/s]Candidates for FashionIQ (rank 0):  28%|██▊       | 71/250 [00:17<00:46,  3.87it/s]Candidates for FashionIQ (rank 0):  29%|██▉       | 72/250 [00:17<00:46,  3.81it/s]Candidates for FashionIQ (rank 0):  29%|██▉       | 73/250 [00:18<00:45,  3.92it/s]Candidates for FashionIQ (rank 0):  30%|██▉       | 74/250 [00:18<00:44,  4.00it/s]Candidates for FashionIQ (rank 0):  30%|███       | 75/250 [00:18<00:45,  3.88it/s]Candidates for FashionIQ (rank 0):  30%|███       | 76/250 [00:18<00:43,  4.02it/s]Candidates for FashionIQ (rank 0):  31%|███       | 77/250 [00:19<00:43,  3.98it/s]Candidates for FashionIQ (rank 0):  31%|███       | 78/250 [00:19<00:44,  3.87it/s]Candidates for FashionIQ (rank 0):  32%|███▏      | 79/250 [00:19<00:42,  3.98it/s]Candidates for FashionIQ (rank 0):  32%|███▏      | 80/250 [00:19<00:42,  3.97it/s]Candidates for FashionIQ (rank 0):  32%|███▏      | 81/250 [00:20<00:43,  3.87it/s]Candidates for FashionIQ (rank 0):  33%|███▎      | 82/250 [00:20<00:43,  3.90it/s]Candidates for FashionIQ (rank 0):  33%|███▎      | 83/250 [00:20<00:42,  3.94it/s]Candidates for FashionIQ (rank 0):  34%|███▎      | 84/250 [00:21<00:46,  3.57it/s]Candidates for FashionIQ (rank 0):  34%|███▍      | 85/250 [00:21<00:48,  3.41it/s]Candidates for FashionIQ (rank 0):  34%|███▍      | 86/250 [00:21<00:51,  3.19it/s]Candidates for FashionIQ (rank 0):  35%|███▍      | 87/250 [00:22<00:47,  3.45it/s]Candidates for FashionIQ (rank 0):  35%|███▌      | 88/250 [00:22<00:44,  3.68it/s]Candidates for FashionIQ (rank 0):  36%|███▌      | 89/250 [00:22<00:43,  3.70it/s]Candidates for FashionIQ (rank 0):  36%|███▌      | 90/250 [00:22<00:41,  3.81it/s]Candidates for FashionIQ (rank 0):  36%|███▋      | 91/250 [00:23<00:42,  3.74it/s]Candidates for FashionIQ (rank 0):  37%|███▋      | 92/250 [00:23<00:42,  3.70it/s]Candidates for FashionIQ (rank 0):  37%|███▋      | 93/250 [00:23<00:42,  3.69it/s]Candidates for FashionIQ (rank 0):  38%|███▊      | 94/250 [00:23<00:44,  3.54it/s]Candidates for FashionIQ (rank 0):  38%|███▊      | 95/250 [00:24<00:41,  3.71it/s]Candidates for FashionIQ (rank 0):  38%|███▊      | 96/250 [00:24<00:41,  3.75it/s]Candidates for FashionIQ (rank 0):  39%|███▉      | 97/250 [00:24<00:39,  3.89it/s]Candidates for FashionIQ (rank 0):  39%|███▉      | 98/250 [00:24<00:40,  3.80it/s]Candidates for FashionIQ (rank 0):  40%|███▉      | 99/250 [00:25<00:37,  3.99it/s]Candidates for FashionIQ (rank 0):  40%|████      | 100/250 [00:25<00:36,  4.07it/s]Candidates for FashionIQ (rank 0):  40%|████      | 101/250 [00:25<00:35,  4.20it/s]Candidates for FashionIQ (rank 0):  41%|████      | 102/250 [00:25<00:35,  4.19it/s]Candidates for FashionIQ (rank 0):  41%|████      | 103/250 [00:26<00:34,  4.20it/s]Candidates for FashionIQ (rank 0):  42%|████▏     | 104/250 [00:26<00:35,  4.06it/s]Candidates for FashionIQ (rank 0):  42%|████▏     | 105/250 [00:26<00:34,  4.19it/s]Candidates for FashionIQ (rank 0):  42%|████▏     | 106/250 [00:26<00:35,  4.07it/s]Candidates for FashionIQ (rank 0):  43%|████▎     | 107/250 [00:27<00:35,  3.98it/s]Candidates for FashionIQ (rank 0):  43%|████▎     | 108/250 [00:27<00:35,  4.04it/s]Candidates for FashionIQ (rank 0):  44%|████▎     | 109/250 [00:27<00:35,  3.95it/s]Candidates for FashionIQ (rank 0):  44%|████▍     | 110/250 [00:27<00:37,  3.76it/s]Candidates for FashionIQ (rank 0):  44%|████▍     | 111/250 [00:28<00:35,  3.90it/s]Candidates for FashionIQ (rank 0):  45%|████▍     | 112/250 [00:28<00:35,  3.91it/s]Candidates for FashionIQ (rank 0):  45%|████▌     | 113/250 [00:28<00:37,  3.67it/s]Candidates for FashionIQ (rank 0):  46%|████▌     | 114/250 [00:28<00:37,  3.67it/s]Candidates for FashionIQ (rank 0):  46%|████▌     | 115/250 [00:29<00:35,  3.76it/s]Candidates for FashionIQ (rank 0):  46%|████▋     | 116/250 [00:29<00:34,  3.84it/s]Candidates for FashionIQ (rank 0):  47%|████▋     | 117/250 [00:29<00:34,  3.90it/s]Candidates for FashionIQ (rank 0):  47%|████▋     | 118/250 [00:30<00:36,  3.63it/s]Candidates for FashionIQ (rank 0):  48%|████▊     | 119/250 [00:30<00:36,  3.57it/s]Candidates for FashionIQ (rank 0):  48%|████▊     | 120/250 [00:30<00:34,  3.80it/s]Candidates for FashionIQ (rank 0):  48%|████▊     | 121/250 [00:30<00:32,  3.93it/s]Candidates for FashionIQ (rank 0):  49%|████▉     | 122/250 [00:30<00:31,  4.03it/s]Candidates for FashionIQ (rank 0):  49%|████▉     | 123/250 [00:31<00:32,  3.92it/s]Candidates for FashionIQ (rank 0):  50%|████▉     | 124/250 [00:31<00:31,  4.02it/s]Candidates for FashionIQ (rank 0):  50%|█████     | 125/250 [00:31<00:30,  4.13it/s]Candidates for FashionIQ (rank 0):  50%|█████     | 126/250 [00:31<00:29,  4.17it/s]Candidates for FashionIQ (rank 0):  51%|█████     | 127/250 [00:32<00:31,  3.85it/s]Candidates for FashionIQ (rank 0):  51%|█████     | 128/250 [00:32<00:32,  3.77it/s]Candidates for FashionIQ (rank 0):  52%|█████▏    | 129/250 [00:32<00:31,  3.89it/s]Candidates for FashionIQ (rank 0):  52%|█████▏    | 130/250 [00:33<00:32,  3.71it/s]Candidates for FashionIQ (rank 0):  52%|█████▏    | 131/250 [00:33<00:32,  3.67it/s]Candidates for FashionIQ (rank 0):  53%|█████▎    | 132/250 [00:33<00:33,  3.53it/s]Candidates for FashionIQ (rank 0):  53%|█████▎    | 133/250 [00:33<00:30,  3.78it/s]Candidates for FashionIQ (rank 0):  54%|█████▎    | 134/250 [00:34<00:29,  3.94it/s]Candidates for FashionIQ (rank 0):  54%|█████▍    | 135/250 [00:34<00:29,  3.93it/s]Candidates for FashionIQ (rank 0):  54%|█████▍    | 136/250 [00:34<00:28,  3.96it/s]Candidates for FashionIQ (rank 0):  55%|█████▍    | 137/250 [00:34<00:29,  3.88it/s]Candidates for FashionIQ (rank 0):  55%|█████▌    | 138/250 [00:35<00:27,  4.02it/s]Candidates for FashionIQ (rank 0):  56%|█████▌    | 139/250 [00:35<00:28,  3.91it/s]Candidates for FashionIQ (rank 0):  56%|█████▌    | 140/250 [00:35<00:27,  3.93it/s]Candidates for FashionIQ (rank 0):  56%|█████▋    | 141/250 [00:35<00:28,  3.86it/s]Candidates for FashionIQ (rank 0):  57%|█████▋    | 142/250 [00:36<00:26,  4.01it/s]Candidates for FashionIQ (rank 0):  57%|█████▋    | 143/250 [00:36<00:27,  3.83it/s]Candidates for FashionIQ (rank 0):  58%|█████▊    | 144/250 [00:36<00:28,  3.74it/s]Candidates for FashionIQ (rank 0):  58%|█████▊    | 145/250 [00:36<00:28,  3.71it/s]Candidates for FashionIQ (rank 0):  58%|█████▊    | 146/250 [00:37<00:28,  3.62it/s]Candidates for FashionIQ (rank 0):  59%|█████▉    | 147/250 [00:37<00:27,  3.75it/s]Candidates for FashionIQ (rank 0):  59%|█████▉    | 148/250 [00:37<00:26,  3.79it/s]Candidates for FashionIQ (rank 0):  60%|█████▉    | 149/250 [00:38<00:26,  3.77it/s]Candidates for FashionIQ (rank 0):  60%|██████    | 150/250 [00:38<00:25,  3.95it/s]Candidates for FashionIQ (rank 0):  60%|██████    | 151/250 [00:38<00:24,  4.09it/s]Candidates for FashionIQ (rank 0):  61%|██████    | 152/250 [00:38<00:23,  4.19it/s]Candidates for FashionIQ (rank 0):  61%|██████    | 153/250 [00:38<00:23,  4.05it/s]Candidates for FashionIQ (rank 0):  62%|██████▏   | 154/250 [00:39<00:23,  4.06it/s]Candidates for FashionIQ (rank 0):  62%|██████▏   | 155/250 [00:39<00:23,  4.11it/s]Candidates for FashionIQ (rank 0):  62%|██████▏   | 156/250 [00:39<00:22,  4.12it/s]Candidates for FashionIQ (rank 0):  63%|██████▎   | 157/250 [00:40<00:24,  3.81it/s]Candidates for FashionIQ (rank 0):  63%|██████▎   | 158/250 [00:40<00:24,  3.70it/s]Candidates for FashionIQ (rank 0):  64%|██████▎   | 159/250 [00:40<00:23,  3.87it/s]Candidates for FashionIQ (rank 0):  64%|██████▍   | 160/250 [00:40<00:24,  3.73it/s]Candidates for FashionIQ (rank 0):  64%|██████▍   | 161/250 [00:41<00:22,  3.89it/s]Candidates for FashionIQ (rank 0):  65%|██████▍   | 162/250 [00:41<00:21,  4.05it/s]Candidates for FashionIQ (rank 0):  65%|██████▌   | 163/250 [00:41<00:21,  4.06it/s]Candidates for FashionIQ (rank 0):  66%|██████▌   | 164/250 [00:41<00:21,  4.01it/s]Candidates for FashionIQ (rank 0):  66%|██████▌   | 165/250 [00:42<00:22,  3.84it/s]Candidates for FashionIQ (rank 0):  66%|██████▋   | 166/250 [00:42<00:21,  3.88it/s]Candidates for FashionIQ (rank 0):  67%|██████▋   | 167/250 [00:42<00:21,  3.81it/s]Candidates for FashionIQ (rank 0):  67%|██████▋   | 168/250 [00:42<00:22,  3.60it/s]Candidates for FashionIQ (rank 0):  68%|██████▊   | 169/250 [00:43<00:24,  3.35it/s]Candidates for FashionIQ (rank 0):  68%|██████▊   | 170/250 [00:43<00:22,  3.59it/s]Candidates for FashionIQ (rank 0):  68%|██████▊   | 171/250 [00:43<00:22,  3.50it/s]Candidates for FashionIQ (rank 0):  69%|██████▉   | 172/250 [00:44<00:22,  3.45it/s]Candidates for FashionIQ (rank 0):  69%|██████▉   | 173/250 [00:44<00:21,  3.65it/s]Candidates for FashionIQ (rank 0):  70%|██████▉   | 174/250 [00:44<00:19,  3.82it/s]Candidates for FashionIQ (rank 0):  70%|███████   | 175/250 [00:44<00:19,  3.90it/s]Candidates for FashionIQ (rank 0):  70%|███████   | 176/250 [00:45<00:18,  4.04it/s]Candidates for FashionIQ (rank 0):  71%|███████   | 177/250 [00:45<00:18,  3.99it/s]Candidates for FashionIQ (rank 0):  71%|███████   | 178/250 [00:45<00:17,  4.06it/s]Candidates for FashionIQ (rank 0):  72%|███████▏  | 179/250 [00:45<00:18,  3.81it/s]Candidates for FashionIQ (rank 0):  72%|███████▏  | 180/250 [00:46<00:17,  3.90it/s]Candidates for FashionIQ (rank 0):  72%|███████▏  | 181/250 [00:46<00:17,  4.00it/s]Candidates for FashionIQ (rank 0):  73%|███████▎  | 182/250 [00:46<00:17,  4.00it/s]Candidates for FashionIQ (rank 0):  73%|███████▎  | 183/250 [00:46<00:16,  4.02it/s]Candidates for FashionIQ (rank 0):  74%|███████▎  | 184/250 [00:47<00:16,  3.93it/s]Candidates for FashionIQ (rank 0):  74%|███████▍  | 185/250 [00:47<00:16,  3.89it/s]Candidates for FashionIQ (rank 0):  74%|███████▍  | 186/250 [00:47<00:15,  4.03it/s]Candidates for FashionIQ (rank 0):  75%|███████▍  | 187/250 [00:47<00:16,  3.77it/s]Candidates for FashionIQ (rank 0):  75%|███████▌  | 188/250 [00:48<00:16,  3.66it/s]Candidates for FashionIQ (rank 0):  76%|███████▌  | 189/250 [00:48<00:16,  3.81it/s]Candidates for FashionIQ (rank 0):  76%|███████▌  | 190/250 [00:48<00:15,  3.76it/s]Candidates for FashionIQ (rank 0):  76%|███████▋  | 191/250 [00:48<00:15,  3.90it/s]Candidates for FashionIQ (rank 0):  77%|███████▋  | 192/250 [00:49<00:14,  3.89it/s]Candidates for FashionIQ (rank 0):  77%|███████▋  | 193/250 [00:49<00:14,  4.07it/s]Candidates for FashionIQ (rank 0):  78%|███████▊  | 194/250 [00:49<00:13,  4.14it/s]Candidates for FashionIQ (rank 0):  78%|███████▊  | 195/250 [00:49<00:13,  3.93it/s]Candidates for FashionIQ (rank 0):  78%|███████▊  | 196/250 [00:50<00:13,  3.98it/s]Candidates for FashionIQ (rank 0):  79%|███████▉  | 197/250 [00:50<00:14,  3.71it/s]Candidates for FashionIQ (rank 0):  79%|███████▉  | 198/250 [00:50<00:14,  3.69it/s]Candidates for FashionIQ (rank 0):  80%|███████▉  | 199/250 [00:51<00:14,  3.57it/s]Candidates for FashionIQ (rank 0):  80%|████████  | 200/250 [00:51<00:13,  3.59it/s]Candidates for FashionIQ (rank 0):  80%|████████  | 201/250 [00:51<00:13,  3.54it/s]Candidates for FashionIQ (rank 0):  81%|████████  | 202/250 [00:51<00:12,  3.74it/s]Candidates for FashionIQ (rank 0):  81%|████████  | 203/250 [00:52<00:12,  3.89it/s]Candidates for FashionIQ (rank 0):  82%|████████▏ | 204/250 [00:52<00:11,  4.08it/s]Candidates for FashionIQ (rank 0):  82%|████████▏ | 205/250 [00:52<00:11,  4.06it/s]Candidates for FashionIQ (rank 0):  82%|████████▏ | 206/250 [00:52<00:11,  3.89it/s]Candidates for FashionIQ (rank 0):  83%|████████▎ | 207/250 [00:53<00:11,  3.69it/s]Candidates for FashionIQ (rank 0):  83%|████████▎ | 208/250 [00:53<00:11,  3.81it/s]Candidates for FashionIQ (rank 0):  84%|████████▎ | 209/250 [00:53<00:10,  3.78it/s]Candidates for FashionIQ (rank 0):  84%|████████▍ | 210/250 [00:53<00:10,  3.72it/s]Candidates for FashionIQ (rank 0):  84%|████████▍ | 211/250 [00:54<00:10,  3.76it/s]Candidates for FashionIQ (rank 0):  85%|████████▍ | 212/250 [00:54<00:10,  3.71it/s]Candidates for FashionIQ (rank 0):  85%|████████▌ | 213/250 [00:54<00:09,  3.74it/s]Candidates for FashionIQ (rank 0):  86%|████████▌ | 214/250 [00:55<00:10,  3.53it/s]Candidates for FashionIQ (rank 0):  86%|████████▌ | 215/250 [00:55<00:09,  3.65it/s]Candidates for FashionIQ (rank 0):  86%|████████▋ | 216/250 [00:55<00:08,  3.83it/s]Candidates for FashionIQ (rank 0):  87%|████████▋ | 217/250 [00:55<00:08,  3.87it/s]Candidates for FashionIQ (rank 0):  87%|████████▋ | 218/250 [00:55<00:08,  3.98it/s]Candidates for FashionIQ (rank 0):  88%|████████▊ | 219/250 [00:56<00:07,  4.01it/s]Candidates for FashionIQ (rank 0):  88%|████████▊ | 220/250 [00:56<00:07,  3.88it/s]Candidates for FashionIQ (rank 0):  88%|████████▊ | 221/250 [00:56<00:08,  3.55it/s]Candidates for FashionIQ (rank 0):  89%|████████▉ | 222/250 [00:57<00:08,  3.48it/s]Candidates for FashionIQ (rank 0):  89%|████████▉ | 223/250 [00:57<00:07,  3.69it/s]Candidates for FashionIQ (rank 0):  90%|████████▉ | 224/250 [00:57<00:06,  3.84it/s]Candidates for FashionIQ (rank 0):  90%|█████████ | 225/250 [00:57<00:06,  3.91it/s]Candidates for FashionIQ (rank 0):  90%|█████████ | 226/250 [00:58<00:05,  4.05it/s]Candidates for FashionIQ (rank 0):  91%|█████████ | 227/250 [00:58<00:05,  4.15it/s]Candidates for FashionIQ (rank 0):  91%|█████████ | 228/250 [00:58<00:05,  3.92it/s]Candidates for FashionIQ (rank 0):  92%|█████████▏| 229/250 [00:58<00:05,  4.07it/s]Candidates for FashionIQ (rank 0):  92%|█████████▏| 230/250 [00:59<00:05,  3.95it/s]Candidates for FashionIQ (rank 0):  92%|█████████▏| 231/250 [00:59<00:05,  3.58it/s]Candidates for FashionIQ (rank 0):  93%|█████████▎| 232/250 [00:59<00:04,  3.65it/s]Candidates for FashionIQ (rank 0):  93%|█████████▎| 233/250 [00:59<00:04,  3.81it/s]Candidates for FashionIQ (rank 0):  94%|█████████▎| 234/250 [01:00<00:04,  3.72it/s]Candidates for FashionIQ (rank 0):  94%|█████████▍| 235/250 [01:00<00:03,  3.81it/s]Candidates for FashionIQ (rank 0):  94%|█████████▍| 236/250 [01:00<00:03,  3.92it/s]Candidates for FashionIQ (rank 0):  95%|█████████▍| 237/250 [01:00<00:03,  3.88it/s]Candidates for FashionIQ (rank 0):  95%|█████████▌| 238/250 [01:01<00:03,  3.95it/s]Candidates for FashionIQ (rank 0):  96%|█████████▌| 239/250 [01:01<00:02,  3.83it/s]Candidates for FashionIQ (rank 0):  96%|█████████▌| 240/250 [01:01<00:02,  3.92it/s]Candidates for FashionIQ (rank 0):  96%|█████████▋| 241/250 [01:01<00:02,  4.03it/s]Candidates for FashionIQ (rank 0):  97%|█████████▋| 242/250 [01:02<00:02,  3.93it/s]Candidates for FashionIQ (rank 0):  97%|█████████▋| 243/250 [01:02<00:01,  3.83it/s]Candidates for FashionIQ (rank 0):  98%|█████████▊| 244/250 [01:02<00:01,  3.53it/s]Candidates for FashionIQ (rank 0):  98%|█████████▊| 245/250 [01:03<00:01,  3.66it/s]Candidates for FashionIQ (rank 0):  98%|█████████▊| 246/250 [01:03<00:01,  3.84it/s]Candidates for FashionIQ (rank 0):  99%|█████████▉| 247/250 [01:03<00:00,  3.81it/s]Candidates for FashionIQ (rank 0):  99%|█████████▉| 248/250 [01:03<00:00,  3.90it/s]Candidates for FashionIQ (rank 0): 100%|█████████▉| 249/250 [01:04<00:00,  3.82it/s]Candidates for FashionIQ (rank 0): 100%|██████████| 250/250 [01:04<00:00,  4.33it/s]Candidates for FashionIQ (rank 0): 100%|██████████| 250/250 [01:04<00:00,  3.89it/s]
[2025-11-12 19:36:07,423] INFO [src.utils:21] Saved candidate embeddings to /home/infres/zzhu-24/PRIM/VLM2Vec/experiments/public/exps/eval_after_train/DEBUG_12Nov_tail_train_only-Qwen/qwen-Qwen2-VL-2B-Instruct/checkpoint-500/layer_28/retrieval/FashionIQ_tgt
Calculating scores for FashionIQ: 0it [00:00, ?it/s]Calculating scores for FashionIQ: 57it [00:00, 562.39it/s]Calculating scores for FashionIQ: 114it [00:00, 455.83it/s]Calculating scores for FashionIQ: 161it [00:00, 458.01it/s]Calculating scores for FashionIQ: 212it [00:00, 474.05it/s]Calculating scores for FashionIQ: 263it [00:00, 484.32it/s]Calculating scores for FashionIQ: 312it [00:00, 452.17it/s]Calculating scores for FashionIQ: 358it [00:00, 427.60it/s]Calculating scores for FashionIQ: 402it [00:00, 413.07it/s]Calculating scores for FashionIQ: 444it [00:01, 403.21it/s]Calculating scores for FashionIQ: 485it [00:01, 397.15it/s]Calculating scores for FashionIQ: 525it [00:01, 386.04it/s]Calculating scores for FashionIQ: 565it [00:01, 387.79it/s]Calculating scores for FashionIQ: 604it [00:01, 322.57it/s]Calculating scores for FashionIQ: 643it [00:01, 338.80it/s]Calculating scores for FashionIQ: 696it [00:01, 387.91it/s]Calculating scores for FashionIQ: 745it [00:01, 414.15it/s]Calculating scores for FashionIQ: 797it [00:01, 442.83it/s]Calculating scores for FashionIQ: 849it [00:02, 463.99it/s]Calculating scores for FashionIQ: 901it [00:02, 479.45it/s]Calculating scores for FashionIQ: 953it [00:02, 490.72it/s]Calculating scores for FashionIQ: 1000it [00:02, 432.59it/s]
[2025-11-12 19:36:10,062] INFO [src.utils:21] Score of FashionIQ:
[2025-11-12 19:36:10,062] INFO [src.utils:21] {'hit@1': '0.0010', 'hit@5': '0.0020', 'hit@10': '0.0050', 'ndcg_linear@1': '0.0010', 'ndcg_linear@5': '0.0014', 'ndcg_linear@10': '0.0024', 'ndcg_exponential@1': '0.0010', 'ndcg_exponential@5': '0.0014', 'ndcg_exponential@10': '0.0024', 'precision@1': '0.0010', 'precision@5': '0.0004', 'precision@10': '0.0005', 'recall@1': '0.0010', 'recall@5': '0.0020', 'recall@10': '0.0050', 'f1@1': '0.0010', 'f1@5': '0.0007', 'f1@10': '0.0009', 'map@1': '0.0010', 'map@5': '0.0013', 'map@10': '0.0016', 'mrr@1': '0.0010', 'mrr@5': '0.0013', 'mrr@10': '0.0016'}
[2025-11-12 19:36:10,062] INFO [src.utils:21] Outputting final score to: /home/infres/zzhu-24/PRIM/VLM2Vec/experiments/public/exps/eval_after_train/DEBUG_12Nov_tail_train_only-Qwen/qwen-Qwen2-VL-2B-Instruct/checkpoint-500/layer_28/retrieval/FashionIQ_score.json
