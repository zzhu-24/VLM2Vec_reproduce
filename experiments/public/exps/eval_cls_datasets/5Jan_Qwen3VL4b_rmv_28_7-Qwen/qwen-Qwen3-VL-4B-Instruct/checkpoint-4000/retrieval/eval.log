/home/infres/zzhu-24/anaconda3/envs/vlm2vec_update/lib/python3.10/site-packages/requests/__init__.py:86: RequestsDependencyWarning: Unable to find acceptable character detection dependency (chardet or charset_normalizer).
  warnings.warn(
[2026-01-18 16:37:45,527] INFO [src.utils:21] Distributed init debug info:
[2026-01-18 16:37:45,527] INFO [src.utils:21] RANK: None
[2026-01-18 16:37:45,527] INFO [src.utils:21] LOCAL_RANK: None
[2026-01-18 16:37:45,527] INFO [src.utils:21] WORLD_SIZE: None
[2026-01-18 16:37:45,527] INFO [src.utils:21] MASTER_ADDR: None
[2026-01-18 16:37:45,527] INFO [src.utils:21] MASTER_PORT: None
[2026-01-18 16:37:47,286] INFO [src.utils:21] Model Backbone: qwen3_vl
[2026-01-18 16:37:47,286] INFO [src.utils:21] Loading processor from: /home/infres/zzhu-24/PRIM/VLM2Vec/experiments/public/exps/train/5Jan_Qwen3VL4b_rmv_28_7-Qwen/Qwen3-VL-4B-Instruct/checkpoint-4000
[2026-01-18 16:37:49,138] INFO [src.utils:21] Loading backbone [qwen3_vl] from /home/infres/zzhu-24/PRIM/VLM2Vec/experiments/public/exps/train/5Jan_Qwen3VL4b_rmv_28_7-Qwen/Qwen3-VL-4B-Instruct/checkpoint-4000
`torch_dtype` is deprecated! Use `dtype` instead!
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00, 21.31it/s]
[2026-01-18 16:37:49,640] INFO [src.utils:21] Loading LoRA from /home/infres/zzhu-24/PRIM/VLM2Vec/experiments/public/exps/train/5Jan_Qwen3VL4b_rmv_28_7-Qwen/Qwen3-VL-4B-Instruct/checkpoint-4000
[2026-01-18 16:38:34,567] INFO [src.utils:21] [rank=0] Loading the model from Huggingface: Qwen/Qwen3-VL-4B-Instruct...
[2026-01-18 16:38:36,140] INFO [src.utils:21] --- Evaluating N24News ---
Map (num_proc=4): 100%|██████████| 1000/1000 [00:00<?, ? examples/s]Map (num_proc=4): 1250 examples [00:00, 1082.11 examples/s]         Map (num_proc=4): 2000 examples [00:00, 2227.85 examples/s]
[2026-01-18 16:38:38,888] INFO [src.utils:21] Encoding queries...
Queries for N24News (rank 0):   0%|          | 0/42 [00:00<?, ?it/s]You're using a Qwen2TokenizerFast tokenizer. Please note that with a fast tokenizer, using the `__call__` method is faster than using a method to encode the text followed by a call to the `pad` method to get a padded encoding.
Queries for N24News (rank 0):   2%|▏         | 1/42 [00:04<02:54,  4.26s/it]Queries for N24News (rank 0):   5%|▍         | 2/42 [00:07<02:34,  3.86s/it]Queries for N24News (rank 0):   7%|▋         | 3/42 [00:11<02:24,  3.71s/it]Queries for N24News (rank 0):  10%|▉         | 4/42 [00:15<02:23,  3.78s/it]Queries for N24News (rank 0):  12%|█▏        | 5/42 [00:18<02:15,  3.66s/it]Queries for N24News (rank 0):  14%|█▍        | 6/42 [00:22<02:10,  3.63s/it]Queries for N24News (rank 0):  17%|█▋        | 7/42 [00:25<02:07,  3.65s/it]Queries for N24News (rank 0):  19%|█▉        | 8/42 [00:29<02:06,  3.72s/it]Queries for N24News (rank 0):  21%|██▏       | 9/42 [00:33<02:01,  3.69s/it]Queries for N24News (rank 0):  24%|██▍       | 10/42 [00:37<01:57,  3.68s/it]Queries for N24News (rank 0):  26%|██▌       | 11/42 [00:40<01:53,  3.67s/it]Queries for N24News (rank 0):  29%|██▊       | 12/42 [00:44<01:47,  3.58s/it]Queries for N24News (rank 0):  31%|███       | 13/42 [00:47<01:43,  3.57s/it]Queries for N24News (rank 0):  33%|███▎      | 14/42 [00:51<01:40,  3.60s/it]Queries for N24News (rank 0):  36%|███▌      | 15/42 [00:54<01:36,  3.57s/it]Queries for N24News (rank 0):  38%|███▊      | 16/42 [00:58<01:32,  3.55s/it]Queries for N24News (rank 0):  40%|████      | 17/42 [01:01<01:28,  3.55s/it]Queries for N24News (rank 0):  43%|████▎     | 18/42 [01:05<01:25,  3.57s/it]Queries for N24News (rank 0):  45%|████▌     | 19/42 [01:08<01:20,  3.52s/it]Queries for N24News (rank 0):  48%|████▊     | 20/42 [01:12<01:17,  3.54s/it]Queries for N24News (rank 0):  50%|█████     | 21/42 [01:16<01:15,  3.58s/it]Queries for N24News (rank 0):  52%|█████▏    | 22/42 [01:19<01:11,  3.59s/it]Queries for N24News (rank 0):  55%|█████▍    | 23/42 [01:23<01:08,  3.59s/it]Queries for N24News (rank 0):  57%|█████▋    | 24/42 [01:26<01:04,  3.58s/it]Queries for N24News (rank 0):  60%|█████▉    | 25/42 [01:30<01:00,  3.56s/it]Queries for N24News (rank 0):  62%|██████▏   | 26/42 [01:34<00:57,  3.58s/it]Queries for N24News (rank 0):  64%|██████▍   | 27/42 [01:37<00:54,  3.64s/it]Queries for N24News (rank 0):  67%|██████▋   | 28/42 [01:41<00:50,  3.58s/it]Queries for N24News (rank 0):  69%|██████▉   | 29/42 [01:45<00:47,  3.69s/it]Queries for N24News (rank 0):  71%|███████▏  | 30/42 [01:48<00:43,  3.65s/it]Queries for N24News (rank 0):  74%|███████▍  | 31/42 [01:52<00:40,  3.69s/it]Queries for N24News (rank 0):  76%|███████▌  | 32/42 [01:55<00:35,  3.58s/it]Queries for N24News (rank 0):  79%|███████▊  | 33/42 [01:59<00:32,  3.58s/it]Queries for N24News (rank 0):  81%|████████  | 34/42 [02:02<00:28,  3.53s/it]Queries for N24News (rank 0):  83%|████████▎ | 35/42 [02:06<00:24,  3.54s/it]Queries for N24News (rank 0):  86%|████████▌ | 36/42 [02:10<00:21,  3.56s/it]Queries for N24News (rank 0):  88%|████████▊ | 37/42 [02:13<00:17,  3.55s/it]Queries for N24News (rank 0):  90%|█████████ | 38/42 [02:17<00:14,  3.54s/it]Queries for N24News (rank 0):  93%|█████████▎| 39/42 [02:20<00:10,  3.60s/it]Queries for N24News (rank 0):  95%|█████████▌| 40/42 [02:24<00:07,  3.62s/it]Queries for N24News (rank 0):  98%|█████████▊| 41/42 [02:28<00:03,  3.63s/it]Queries for N24News (rank 0): 100%|██████████| 42/42 [02:30<00:00,  3.27s/it]Queries for N24News (rank 0): 100%|██████████| 42/42 [02:30<00:00,  3.59s/it]
[2026-01-18 16:41:09,612] INFO [src.utils:21] Saved query embeddings to /home/infres/zzhu-24/PRIM/VLM2Vec/experiments/public/exps/eval_cls_datasets/5Jan_Qwen3VL4b_rmv_28_7-Qwen/qwen-Qwen3-VL-4B-Instruct/checkpoint-4000/retrieval/layer_29/N24News_qry
[2026-01-18 16:41:09,612] INFO [src.utils:21] Encoding candidates...
Candidates for N24News (rank 0):   0%|          | 0/1 [00:00<?, ?it/s]Candidates for N24News (rank 0): 100%|██████████| 1/1 [00:00<00:00, 11.20it/s]
[2026-01-18 16:41:09,716] INFO [src.utils:21] Saved candidate embeddings to /home/infres/zzhu-24/PRIM/VLM2Vec/experiments/public/exps/eval_cls_datasets/5Jan_Qwen3VL4b_rmv_28_7-Qwen/qwen-Qwen3-VL-4B-Instruct/checkpoint-4000/retrieval/layer_29/N24News_tgt
[2026-01-18 16:41:09,716] INFO [src.utils:21] --- Scoring for layer 29 ---
Calculating scores for N24News: 0it [00:00, ?it/s]Calculating scores for N24News: 1000it [00:00, 10289.01it/s]
[2026-01-18 16:41:09,949] INFO [src.utils:21] Score of N24News:
[2026-01-18 16:41:09,949] INFO [src.utils:21] {'hit@1': '0.2070', 'hit@5': '0.3980', 'hit@10': '0.5760', 'ndcg_linear@1': '0.2070', 'ndcg_linear@5': '0.3068', 'ndcg_linear@10': '0.3634', 'ndcg_exponential@1': '0.2070', 'ndcg_exponential@5': '0.3068', 'ndcg_exponential@10': '0.3634', 'precision@1': '0.2070', 'precision@5': '0.0796', 'precision@10': '0.0576', 'recall@1': '0.2070', 'recall@5': '0.3980', 'recall@10': '0.5760', 'f1@1': '0.2070', 'f1@5': '0.1327', 'f1@10': '0.1047', 'map@1': '0.2070', 'map@5': '0.2766', 'map@10': '0.2995', 'mrr@1': '0.2070', 'mrr@5': '0.2766', 'mrr@10': '0.2995'}
[2026-01-18 16:41:09,949] INFO [src.utils:21] Outputting final score to: /home/infres/zzhu-24/PRIM/VLM2Vec/experiments/public/exps/eval_cls_datasets/5Jan_Qwen3VL4b_rmv_28_7-Qwen/qwen-Qwen3-VL-4B-Instruct/checkpoint-4000/retrieval/layer_29/N24News_score.json
[2026-01-18 16:41:09,958] INFO [src.utils:21] --- Evaluating HatefulMemes ---
Map (num_proc=4): 100%|██████████| 1000/1000 [00:00<?, ? examples/s]Map (num_proc=4): 1250 examples [00:00, 481.78 examples/s]          Map (num_proc=4): 2000 examples [00:00, 1156.86 examples/s]
[2026-01-18 16:41:12,105] INFO [src.utils:21] Encoding queries...
Queries for HatefulMemes (rank 0):   0%|          | 0/42 [00:00<?, ?it/s]Queries for HatefulMemes (rank 0):   2%|▏         | 1/42 [00:02<01:48,  2.65s/it]Queries for HatefulMemes (rank 0):   5%|▍         | 2/42 [00:05<01:47,  2.68s/it]Queries for HatefulMemes (rank 0):   7%|▋         | 3/42 [00:08<01:44,  2.68s/it]Queries for HatefulMemes (rank 0):  10%|▉         | 4/42 [00:10<01:37,  2.57s/it]Queries for HatefulMemes (rank 0):  12%|█▏        | 5/42 [00:13<01:39,  2.70s/it]Queries for HatefulMemes (rank 0):  14%|█▍        | 6/42 [00:16<01:40,  2.78s/it]Queries for HatefulMemes (rank 0):  17%|█▋        | 7/42 [00:19<01:40,  2.87s/it]Queries for HatefulMemes (rank 0):  19%|█▉        | 8/42 [00:21<01:33,  2.76s/it]Queries for HatefulMemes (rank 0):  21%|██▏       | 9/42 [00:24<01:27,  2.66s/it]Queries for HatefulMemes (rank 0):  24%|██▍       | 10/42 [00:27<01:26,  2.69s/it]Queries for HatefulMemes (rank 0):  26%|██▌       | 11/42 [00:29<01:24,  2.73s/it]Queries for HatefulMemes (rank 0):  29%|██▊       | 12/42 [00:32<01:20,  2.69s/it]Queries for HatefulMemes (rank 0):  31%|███       | 13/42 [00:35<01:17,  2.69s/it]Queries for HatefulMemes (rank 0):  33%|███▎      | 14/42 [00:38<01:16,  2.73s/it]Queries for HatefulMemes (rank 0):  36%|███▌      | 15/42 [00:40<01:12,  2.67s/it]Queries for HatefulMemes (rank 0):  38%|███▊      | 16/42 [00:43<01:08,  2.65s/it]Queries for HatefulMemes (rank 0):  40%|████      | 17/42 [00:45<01:06,  2.65s/it]Queries for HatefulMemes (rank 0):  43%|████▎     | 18/42 [00:48<01:04,  2.71s/it]Queries for HatefulMemes (rank 0):  45%|████▌     | 19/42 [00:51<01:03,  2.78s/it]Queries for HatefulMemes (rank 0):  48%|████▊     | 20/42 [00:54<01:04,  2.91s/it]Queries for HatefulMemes (rank 0):  50%|█████     | 21/42 [00:57<01:00,  2.90s/it]Queries for HatefulMemes (rank 0):  52%|█████▏    | 22/42 [01:00<00:56,  2.85s/it]Queries for HatefulMemes (rank 0):  55%|█████▍    | 23/42 [01:03<00:54,  2.86s/it]Queries for HatefulMemes (rank 0):  57%|█████▋    | 24/42 [01:06<00:51,  2.88s/it]Queries for HatefulMemes (rank 0):  60%|█████▉    | 25/42 [01:09<00:49,  2.93s/it]Queries for HatefulMemes (rank 0):  62%|██████▏   | 26/42 [01:11<00:45,  2.84s/it]Queries for HatefulMemes (rank 0):  64%|██████▍   | 27/42 [01:14<00:41,  2.80s/it]Queries for HatefulMemes (rank 0):  67%|██████▋   | 28/42 [01:17<00:40,  2.86s/it]Queries for HatefulMemes (rank 0):  69%|██████▉   | 29/42 [01:20<00:36,  2.80s/it]Queries for HatefulMemes (rank 0):  71%|███████▏  | 30/42 [01:23<00:33,  2.80s/it]Queries for HatefulMemes (rank 0):  74%|███████▍  | 31/42 [01:25<00:30,  2.80s/it]Queries for HatefulMemes (rank 0):  76%|███████▌  | 32/42 [01:28<00:27,  2.78s/it]Queries for HatefulMemes (rank 0):  79%|███████▊  | 33/42 [01:31<00:25,  2.81s/it]Queries for HatefulMemes (rank 0):  81%|████████  | 34/42 [01:34<00:22,  2.81s/it]Queries for HatefulMemes (rank 0):  83%|████████▎ | 35/42 [01:37<00:20,  2.97s/it]Queries for HatefulMemes (rank 0):  86%|████████▌ | 36/42 [01:40<00:17,  2.92s/it]Queries for HatefulMemes (rank 0):  88%|████████▊ | 37/42 [01:43<00:14,  2.84s/it]Queries for HatefulMemes (rank 0):  90%|█████████ | 38/42 [01:46<00:11,  2.93s/it]Queries for HatefulMemes (rank 0):  93%|█████████▎| 39/42 [01:48<00:08,  2.80s/it]Queries for HatefulMemes (rank 0):  95%|█████████▌| 40/42 [01:51<00:05,  2.89s/it]Queries for HatefulMemes (rank 0):  98%|█████████▊| 41/42 [01:54<00:02,  2.84s/it]Queries for HatefulMemes (rank 0): 100%|██████████| 42/42 [01:56<00:00,  2.62s/it]Queries for HatefulMemes (rank 0): 100%|██████████| 42/42 [01:56<00:00,  2.78s/it]
[2026-01-18 16:43:08,833] INFO [src.utils:21] Saved query embeddings to /home/infres/zzhu-24/PRIM/VLM2Vec/experiments/public/exps/eval_cls_datasets/5Jan_Qwen3VL4b_rmv_28_7-Qwen/qwen-Qwen3-VL-4B-Instruct/checkpoint-4000/retrieval/layer_29/HatefulMemes_qry
[2026-01-18 16:43:08,833] INFO [src.utils:21] Encoding candidates...
Candidates for HatefulMemes (rank 0):   0%|          | 0/1 [00:00<?, ?it/s]Candidates for HatefulMemes (rank 0): 100%|██████████| 1/1 [00:00<00:00, 14.01it/s]
[2026-01-18 16:43:08,910] INFO [src.utils:21] Saved candidate embeddings to /home/infres/zzhu-24/PRIM/VLM2Vec/experiments/public/exps/eval_cls_datasets/5Jan_Qwen3VL4b_rmv_28_7-Qwen/qwen-Qwen3-VL-4B-Instruct/checkpoint-4000/retrieval/layer_29/HatefulMemes_tgt
[2026-01-18 16:43:08,910] INFO [src.utils:21] --- Scoring for layer 29 ---
Calculating scores for HatefulMemes: 0it [00:00, ?it/s]Calculating scores for HatefulMemes: 1000it [00:00, 37324.51it/s]
[2026-01-18 16:43:09,103] INFO [src.utils:21] Score of HatefulMemes:
[2026-01-18 16:43:09,103] INFO [src.utils:21] {'hit@1': '0.4810', 'hit@5': '1.0000', 'hit@10': '1.0000', 'ndcg_linear@1': '0.4810', 'ndcg_linear@5': '0.8085', 'ndcg_linear@10': '0.8085', 'ndcg_exponential@1': '0.4810', 'ndcg_exponential@5': '0.8085', 'ndcg_exponential@10': '0.8085', 'precision@1': '0.4810', 'precision@5': '0.2000', 'precision@10': '0.1000', 'recall@1': '0.4810', 'recall@5': '1.0000', 'recall@10': '1.0000', 'f1@1': '0.4810', 'f1@5': '0.3333', 'f1@10': '0.1818', 'map@1': '0.4810', 'map@5': '0.7405', 'map@10': '0.7405', 'mrr@1': '0.4810', 'mrr@5': '0.7405', 'mrr@10': '0.7405'}
[2026-01-18 16:43:09,103] INFO [src.utils:21] Outputting final score to: /home/infres/zzhu-24/PRIM/VLM2Vec/experiments/public/exps/eval_cls_datasets/5Jan_Qwen3VL4b_rmv_28_7-Qwen/qwen-Qwen3-VL-4B-Instruct/checkpoint-4000/retrieval/layer_29/HatefulMemes_score.json
[2026-01-18 16:43:09,108] INFO [src.utils:21] --- Evaluating VOC2007 ---
Map (num_proc=4): 100%|██████████| 1000/1000 [00:00<?, ? examples/s]Map (num_proc=4): 1250 examples [00:00, 501.86 examples/s]          Map (num_proc=4): 2000 examples [00:00, 1198.63 examples/s]
[2026-01-18 16:43:11,483] INFO [src.utils:21] Encoding queries...
Queries for VOC2007 (rank 0):   0%|          | 0/42 [00:00<?, ?it/s]Queries for VOC2007 (rank 0):   2%|▏         | 1/42 [00:00<00:32,  1.25it/s]Queries for VOC2007 (rank 0):   5%|▍         | 2/42 [00:01<00:30,  1.30it/s]Queries for VOC2007 (rank 0):   7%|▋         | 3/42 [00:02<00:29,  1.32it/s]Queries for VOC2007 (rank 0):  10%|▉         | 4/42 [00:02<00:26,  1.45it/s]Queries for VOC2007 (rank 0):  12%|█▏        | 5/42 [00:03<00:26,  1.41it/s]Queries for VOC2007 (rank 0):  14%|█▍        | 6/42 [00:04<00:24,  1.50it/s]Queries for VOC2007 (rank 0):  17%|█▋        | 7/42 [00:05<00:25,  1.37it/s]Queries for VOC2007 (rank 0):  19%|█▉        | 8/42 [00:05<00:24,  1.39it/s]Queries for VOC2007 (rank 0):  21%|██▏       | 9/42 [00:06<00:22,  1.46it/s]Queries for VOC2007 (rank 0):  24%|██▍       | 10/42 [00:07<00:21,  1.48it/s]Queries for VOC2007 (rank 0):  26%|██▌       | 11/42 [00:07<00:22,  1.38it/s]Queries for VOC2007 (rank 0):  29%|██▊       | 12/42 [00:08<00:22,  1.32it/s]Queries for VOC2007 (rank 0):  31%|███       | 13/42 [00:09<00:22,  1.28it/s]Queries for VOC2007 (rank 0):  33%|███▎      | 14/42 [00:10<00:21,  1.30it/s]Queries for VOC2007 (rank 0):  36%|███▌      | 15/42 [00:11<00:20,  1.31it/s]Queries for VOC2007 (rank 0):  38%|███▊      | 16/42 [00:11<00:19,  1.31it/s]Queries for VOC2007 (rank 0):  40%|████      | 17/42 [00:12<00:19,  1.30it/s]Queries for VOC2007 (rank 0):  43%|████▎     | 18/42 [00:13<00:19,  1.25it/s]Queries for VOC2007 (rank 0):  45%|████▌     | 19/42 [00:14<00:17,  1.33it/s]Queries for VOC2007 (rank 0):  48%|████▊     | 20/42 [00:14<00:15,  1.41it/s]Queries for VOC2007 (rank 0):  50%|█████     | 21/42 [00:15<00:14,  1.44it/s]Queries for VOC2007 (rank 0):  52%|█████▏    | 22/42 [00:16<00:14,  1.42it/s]Queries for VOC2007 (rank 0):  55%|█████▍    | 23/42 [00:16<00:13,  1.40it/s]Queries for VOC2007 (rank 0):  57%|█████▋    | 24/42 [00:17<00:13,  1.36it/s]Queries for VOC2007 (rank 0):  60%|█████▉    | 25/42 [00:18<00:13,  1.31it/s]Queries for VOC2007 (rank 0):  62%|██████▏   | 26/42 [00:19<00:13,  1.23it/s]Queries for VOC2007 (rank 0):  64%|██████▍   | 27/42 [00:20<00:11,  1.26it/s]Queries for VOC2007 (rank 0):  67%|██████▋   | 28/42 [00:20<00:10,  1.28it/s]Queries for VOC2007 (rank 0):  69%|██████▉   | 29/42 [00:21<00:10,  1.21it/s]Queries for VOC2007 (rank 0):  71%|███████▏  | 30/42 [00:22<00:09,  1.25it/s]Queries for VOC2007 (rank 0):  74%|███████▍  | 31/42 [00:23<00:08,  1.27it/s]Queries for VOC2007 (rank 0):  76%|███████▌  | 32/42 [00:24<00:08,  1.22it/s]Queries for VOC2007 (rank 0):  79%|███████▊  | 33/42 [00:25<00:07,  1.14it/s]Queries for VOC2007 (rank 0):  81%|████████  | 34/42 [00:25<00:06,  1.25it/s]Queries for VOC2007 (rank 0):  83%|████████▎ | 35/42 [00:26<00:05,  1.27it/s]Queries for VOC2007 (rank 0):  86%|████████▌ | 36/42 [00:27<00:04,  1.39it/s]Queries for VOC2007 (rank 0):  88%|████████▊ | 37/42 [00:27<00:03,  1.32it/s]Queries for VOC2007 (rank 0):  90%|█████████ | 38/42 [00:28<00:03,  1.30it/s]Queries for VOC2007 (rank 0):  93%|█████████▎| 39/42 [00:29<00:02,  1.37it/s]Queries for VOC2007 (rank 0):  95%|█████████▌| 40/42 [00:30<00:01,  1.30it/s]Queries for VOC2007 (rank 0):  98%|█████████▊| 41/42 [00:31<00:00,  1.26it/s]Queries for VOC2007 (rank 0): 100%|██████████| 42/42 [00:31<00:00,  1.41it/s]Queries for VOC2007 (rank 0): 100%|██████████| 42/42 [00:31<00:00,  1.33it/s]
[2026-01-18 16:43:43,231] INFO [src.utils:21] Saved query embeddings to /home/infres/zzhu-24/PRIM/VLM2Vec/experiments/public/exps/eval_cls_datasets/5Jan_Qwen3VL4b_rmv_28_7-Qwen/qwen-Qwen3-VL-4B-Instruct/checkpoint-4000/retrieval/layer_29/VOC2007_qry
[2026-01-18 16:43:43,231] INFO [src.utils:21] Encoding candidates...
Candidates for VOC2007 (rank 0):   0%|          | 0/1 [00:00<?, ?it/s]Candidates for VOC2007 (rank 0): 100%|██████████| 1/1 [00:00<00:00, 12.42it/s]
[2026-01-18 16:43:43,318] INFO [src.utils:21] Saved candidate embeddings to /home/infres/zzhu-24/PRIM/VLM2Vec/experiments/public/exps/eval_cls_datasets/5Jan_Qwen3VL4b_rmv_28_7-Qwen/qwen-Qwen3-VL-4B-Instruct/checkpoint-4000/retrieval/layer_29/VOC2007_tgt
[2026-01-18 16:43:43,318] INFO [src.utils:21] --- Scoring for layer 29 ---
Calculating scores for VOC2007: 0it [00:00, ?it/s]Calculating scores for VOC2007: 1000it [00:00, 12154.87it/s]
[2026-01-18 16:43:43,626] INFO [src.utils:21] Score of VOC2007:
[2026-01-18 16:43:43,626] INFO [src.utils:21] {'hit@1': '0.2290', 'hit@5': '0.5860', 'hit@10': '0.8310', 'ndcg_linear@1': '0.2290', 'ndcg_linear@5': '0.4043', 'ndcg_linear@10': '0.4827', 'ndcg_exponential@1': '0.2290', 'ndcg_exponential@5': '0.4043', 'ndcg_exponential@10': '0.4827', 'precision@1': '0.2290', 'precision@5': '0.1172', 'precision@10': '0.0831', 'recall@1': '0.2290', 'recall@5': '0.5860', 'recall@10': '0.8310', 'f1@1': '0.2290', 'f1@5': '0.1953', 'f1@10': '0.1511', 'map@1': '0.2290', 'map@5': '0.3452', 'map@10': '0.3771', 'mrr@1': '0.2290', 'mrr@5': '0.3452', 'mrr@10': '0.3771'}
[2026-01-18 16:43:43,627] INFO [src.utils:21] Outputting final score to: /home/infres/zzhu-24/PRIM/VLM2Vec/experiments/public/exps/eval_cls_datasets/5Jan_Qwen3VL4b_rmv_28_7-Qwen/qwen-Qwen3-VL-4B-Instruct/checkpoint-4000/retrieval/layer_29/VOC2007_score.json
[2026-01-18 16:43:43,636] INFO [src.utils:21] --- Evaluating Place365 ---
Map (num_proc=4): 100%|██████████| 1000/1000 [00:00<?, ? examples/s]Map (num_proc=4): 1250 examples [00:00, 408.89 examples/s]          Map (num_proc=4): 2000 examples [00:00, 1670.99 examples/s]Map (num_proc=4): 2000 examples [00:01, 888.66 examples/s] 
[2026-01-18 16:43:46,829] INFO [src.utils:21] Encoding queries...
Queries for Place365 (rank 0):   0%|          | 0/42 [00:00<?, ?it/s]Queries for Place365 (rank 0):   2%|▏         | 1/42 [00:00<00:25,  1.61it/s]Queries for Place365 (rank 0):   5%|▍         | 2/42 [00:01<00:23,  1.68it/s]Queries for Place365 (rank 0):   7%|▋         | 3/42 [00:01<00:22,  1.71it/s]Queries for Place365 (rank 0):  10%|▉         | 4/42 [00:02<00:21,  1.73it/s]Queries for Place365 (rank 0):  12%|█▏        | 5/42 [00:02<00:21,  1.73it/s]Queries for Place365 (rank 0):  14%|█▍        | 6/42 [00:03<00:20,  1.74it/s]Queries for Place365 (rank 0):  17%|█▋        | 7/42 [00:04<00:20,  1.74it/s]Queries for Place365 (rank 0):  19%|█▉        | 8/42 [00:04<00:19,  1.73it/s]Queries for Place365 (rank 0):  21%|██▏       | 9/42 [00:05<00:19,  1.73it/s]Queries for Place365 (rank 0):  24%|██▍       | 10/42 [00:05<00:18,  1.73it/s]Queries for Place365 (rank 0):  26%|██▌       | 11/42 [00:06<00:17,  1.73it/s]Queries for Place365 (rank 0):  29%|██▊       | 12/42 [00:06<00:17,  1.71it/s]Queries for Place365 (rank 0):  31%|███       | 13/42 [00:07<00:16,  1.72it/s]Queries for Place365 (rank 0):  33%|███▎      | 14/42 [00:08<00:16,  1.73it/s]Queries for Place365 (rank 0):  36%|███▌      | 15/42 [00:08<00:15,  1.72it/s]Queries for Place365 (rank 0):  38%|███▊      | 16/42 [00:09<00:15,  1.73it/s]Queries for Place365 (rank 0):  40%|████      | 17/42 [00:09<00:14,  1.73it/s]Queries for Place365 (rank 0):  43%|████▎     | 18/42 [00:10<00:13,  1.74it/s]Queries for Place365 (rank 0):  45%|████▌     | 19/42 [00:11<00:13,  1.74it/s]Queries for Place365 (rank 0):  48%|████▊     | 20/42 [00:11<00:12,  1.74it/s]Queries for Place365 (rank 0):  50%|█████     | 21/42 [00:12<00:12,  1.71it/s]Queries for Place365 (rank 0):  52%|█████▏    | 22/42 [00:12<00:11,  1.72it/s]Queries for Place365 (rank 0):  55%|█████▍    | 23/42 [00:13<00:11,  1.72it/s]Queries for Place365 (rank 0):  57%|█████▋    | 24/42 [00:13<00:10,  1.73it/s]Queries for Place365 (rank 0):  60%|█████▉    | 25/42 [00:14<00:09,  1.73it/s]Queries for Place365 (rank 0):  62%|██████▏   | 26/42 [00:15<00:09,  1.73it/s]Queries for Place365 (rank 0):  64%|██████▍   | 27/42 [00:15<00:08,  1.74it/s]Queries for Place365 (rank 0):  67%|██████▋   | 28/42 [00:16<00:08,  1.74it/s]Queries for Place365 (rank 0):  69%|██████▉   | 29/42 [00:16<00:07,  1.74it/s]Queries for Place365 (rank 0):  71%|███████▏  | 30/42 [00:17<00:06,  1.74it/s]Queries for Place365 (rank 0):  74%|███████▍  | 31/42 [00:17<00:06,  1.73it/s]Queries for Place365 (rank 0):  76%|███████▌  | 32/42 [00:18<00:05,  1.74it/s]Queries for Place365 (rank 0):  79%|███████▊  | 33/42 [00:19<00:05,  1.74it/s]Queries for Place365 (rank 0):  81%|████████  | 34/42 [00:19<00:04,  1.74it/s]Queries for Place365 (rank 0):  83%|████████▎ | 35/42 [00:20<00:04,  1.74it/s]Queries for Place365 (rank 0):  86%|████████▌ | 36/42 [00:20<00:03,  1.74it/s]Queries for Place365 (rank 0):  88%|████████▊ | 37/42 [00:21<00:02,  1.73it/s]Queries for Place365 (rank 0):  90%|█████████ | 38/42 [00:21<00:02,  1.74it/s]Queries for Place365 (rank 0):  93%|█████████▎| 39/42 [00:22<00:01,  1.74it/s]Queries for Place365 (rank 0):  95%|█████████▌| 40/42 [00:23<00:01,  1.73it/s]Queries for Place365 (rank 0):  98%|█████████▊| 41/42 [00:23<00:00,  1.73it/s]Queries for Place365 (rank 0): 100%|██████████| 42/42 [00:24<00:00,  1.88it/s]Queries for Place365 (rank 0): 100%|██████████| 42/42 [00:24<00:00,  1.74it/s]
[2026-01-18 16:44:11,145] INFO [src.utils:21] Saved query embeddings to /home/infres/zzhu-24/PRIM/VLM2Vec/experiments/public/exps/eval_cls_datasets/5Jan_Qwen3VL4b_rmv_28_7-Qwen/qwen-Qwen3-VL-4B-Instruct/checkpoint-4000/retrieval/layer_29/Place365_qry
[2026-01-18 16:44:11,145] INFO [src.utils:21] Encoding candidates...
Candidates for Place365 (rank 0):   0%|          | 0/16 [00:00<?, ?it/s]Candidates for Place365 (rank 0):  12%|█▎        | 2/16 [00:00<00:01, 11.00it/s]Candidates for Place365 (rank 0):  25%|██▌       | 4/16 [00:00<00:01, 11.82it/s]Candidates for Place365 (rank 0):  38%|███▊      | 6/16 [00:00<00:00, 11.85it/s]Candidates for Place365 (rank 0):  50%|█████     | 8/16 [00:00<00:00, 12.14it/s]Candidates for Place365 (rank 0):  62%|██████▎   | 10/16 [00:00<00:00, 12.33it/s]Candidates for Place365 (rank 0):  75%|███████▌  | 12/16 [00:00<00:00, 12.70it/s]Candidates for Place365 (rank 0):  88%|████████▊ | 14/16 [00:01<00:00, 12.67it/s]Candidates for Place365 (rank 0): 100%|██████████| 16/16 [00:01<00:00, 12.93it/s]Candidates for Place365 (rank 0): 100%|██████████| 16/16 [00:01<00:00, 12.48it/s]
[2026-01-18 16:44:12,469] INFO [src.utils:21] Saved candidate embeddings to /home/infres/zzhu-24/PRIM/VLM2Vec/experiments/public/exps/eval_cls_datasets/5Jan_Qwen3VL4b_rmv_28_7-Qwen/qwen-Qwen3-VL-4B-Instruct/checkpoint-4000/retrieval/layer_29/Place365_tgt
[2026-01-18 16:44:12,469] INFO [src.utils:21] --- Scoring for layer 29 ---
Calculating scores for Place365: 0it [00:00, ?it/s]Calculating scores for Place365: 68it [00:00, 679.53it/s]Calculating scores for Place365: 137it [00:00, 684.73it/s]Calculating scores for Place365: 207it [00:00, 687.17it/s]Calculating scores for Place365: 276it [00:00, 672.09it/s]Calculating scores for Place365: 345it [00:00, 677.73it/s]Calculating scores for Place365: 414it [00:00, 680.43it/s]Calculating scores for Place365: 483it [00:00, 682.55it/s]Calculating scores for Place365: 552it [00:00, 677.90it/s]Calculating scores for Place365: 622it [00:00, 682.14it/s]Calculating scores for Place365: 691it [00:01, 683.95it/s]Calculating scores for Place365: 760it [00:01, 678.97it/s]Calculating scores for Place365: 829it [00:01, 681.20it/s]Calculating scores for Place365: 898it [00:01, 683.37it/s]Calculating scores for Place365: 967it [00:01, 684.80it/s]Calculating scores for Place365: 1000it [00:01, 680.54it/s]
[2026-01-18 16:44:14,142] INFO [src.utils:21] Score of Place365:
[2026-01-18 16:44:14,143] INFO [src.utils:21] {'hit@1': '0.2290', 'hit@5': '0.4710', 'hit@10': '0.5850', 'ndcg_linear@1': '0.2290', 'ndcg_linear@5': '0.3587', 'ndcg_linear@10': '0.3957', 'ndcg_exponential@1': '0.2290', 'ndcg_exponential@5': '0.3587', 'ndcg_exponential@10': '0.3957', 'precision@1': '0.2290', 'precision@5': '0.0942', 'precision@10': '0.0585', 'recall@1': '0.2290', 'recall@5': '0.4710', 'recall@10': '0.5850', 'f1@1': '0.2290', 'f1@5': '0.1570', 'f1@10': '0.1064', 'map@1': '0.2290', 'map@5': '0.3212', 'map@10': '0.3366', 'mrr@1': '0.2290', 'mrr@5': '0.3212', 'mrr@10': '0.3366'}
[2026-01-18 16:44:14,143] INFO [src.utils:21] Outputting final score to: /home/infres/zzhu-24/PRIM/VLM2Vec/experiments/public/exps/eval_cls_datasets/5Jan_Qwen3VL4b_rmv_28_7-Qwen/qwen-Qwen3-VL-4B-Instruct/checkpoint-4000/retrieval/layer_29/Place365_score.json
[2026-01-18 16:44:14,243] INFO [src.utils:21] --- Evaluating Country211 ---
Map (num_proc=4): 100%|██████████| 1000/1000 [00:00<?, ? examples/s]Map (num_proc=4): 1250 examples [00:00, 407.37 examples/s]          Map (num_proc=4): 2000 examples [00:01, 979.98 examples/s]
[2026-01-18 16:44:17,172] INFO [src.utils:21] Encoding queries...
Queries for Country211 (rank 0):   0%|          | 0/42 [00:00<?, ?it/s]Queries for Country211 (rank 0):   2%|▏         | 1/42 [00:01<00:53,  1.32s/it]Queries for Country211 (rank 0):   5%|▍         | 2/42 [00:02<00:51,  1.28s/it]Queries for Country211 (rank 0):   7%|▋         | 3/42 [00:03<00:49,  1.27s/it]Queries for Country211 (rank 0):  10%|▉         | 4/42 [00:05<00:47,  1.26s/it]Queries for Country211 (rank 0):  12%|█▏        | 5/42 [00:06<00:46,  1.25s/it]Queries for Country211 (rank 0):  14%|█▍        | 6/42 [00:07<00:46,  1.31s/it]Queries for Country211 (rank 0):  17%|█▋        | 7/42 [00:09<00:47,  1.37s/it]Queries for Country211 (rank 0):  19%|█▉        | 8/42 [00:10<00:45,  1.33s/it]Queries for Country211 (rank 0):  21%|██▏       | 9/42 [00:11<00:43,  1.31s/it]Queries for Country211 (rank 0):  24%|██▍       | 10/42 [00:13<00:43,  1.37s/it]Queries for Country211 (rank 0):  26%|██▌       | 11/42 [00:14<00:43,  1.40s/it]Queries for Country211 (rank 0):  29%|██▊       | 12/42 [00:16<00:42,  1.43s/it]Queries for Country211 (rank 0):  31%|███       | 13/42 [00:17<00:40,  1.39s/it]Queries for Country211 (rank 0):  33%|███▎      | 14/42 [00:18<00:39,  1.42s/it]Queries for Country211 (rank 0):  36%|███▌      | 15/42 [00:20<00:36,  1.37s/it]Queries for Country211 (rank 0):  38%|███▊      | 16/42 [00:21<00:36,  1.41s/it]Queries for Country211 (rank 0):  40%|████      | 17/42 [00:23<00:35,  1.42s/it]Queries for Country211 (rank 0):  43%|████▎     | 18/42 [00:24<00:34,  1.44s/it]Queries for Country211 (rank 0):  45%|████▌     | 19/42 [00:25<00:32,  1.40s/it]Queries for Country211 (rank 0):  48%|████▊     | 20/42 [00:27<00:29,  1.35s/it]Queries for Country211 (rank 0):  50%|█████     | 21/42 [00:28<00:27,  1.32s/it]Queries for Country211 (rank 0):  52%|█████▏    | 22/42 [00:29<00:27,  1.36s/it]Queries for Country211 (rank 0):  55%|█████▍    | 23/42 [00:31<00:26,  1.40s/it]Queries for Country211 (rank 0):  57%|█████▋    | 24/42 [00:32<00:25,  1.43s/it]Queries for Country211 (rank 0):  60%|█████▉    | 25/42 [00:34<00:24,  1.44s/it]Queries for Country211 (rank 0):  62%|██████▏   | 26/42 [00:35<00:23,  1.45s/it]Queries for Country211 (rank 0):  64%|██████▍   | 27/42 [00:37<00:21,  1.42s/it]Queries for Country211 (rank 0):  67%|██████▋   | 28/42 [00:38<00:19,  1.37s/it]Queries for Country211 (rank 0):  69%|██████▉   | 29/42 [00:39<00:18,  1.40s/it]Queries for Country211 (rank 0):  71%|███████▏  | 30/42 [00:41<00:16,  1.40s/it]Queries for Country211 (rank 0):  74%|███████▍  | 31/42 [00:42<00:14,  1.35s/it]Queries for Country211 (rank 0):  76%|███████▌  | 32/42 [00:44<00:13,  1.39s/it]Queries for Country211 (rank 0):  79%|███████▊  | 33/42 [00:45<00:12,  1.43s/it]Queries for Country211 (rank 0):  81%|████████  | 34/42 [00:46<00:11,  1.40s/it]Queries for Country211 (rank 0):  83%|████████▎ | 35/42 [00:48<00:09,  1.39s/it]Queries for Country211 (rank 0):  86%|████████▌ | 36/42 [00:49<00:08,  1.48s/it]Queries for Country211 (rank 0):  88%|████████▊ | 37/42 [00:51<00:07,  1.48s/it]Queries for Country211 (rank 0):  90%|█████████ | 38/42 [00:52<00:05,  1.49s/it]Queries for Country211 (rank 0):  93%|█████████▎| 39/42 [00:54<00:04,  1.48s/it]Queries for Country211 (rank 0):  95%|█████████▌| 40/42 [00:55<00:02,  1.41s/it]Queries for Country211 (rank 0):  98%|█████████▊| 41/42 [00:57<00:01,  1.44s/it]Queries for Country211 (rank 0): 100%|██████████| 42/42 [00:58<00:00,  1.32s/it]Queries for Country211 (rank 0): 100%|██████████| 42/42 [00:58<00:00,  1.39s/it]
[2026-01-18 16:45:15,517] INFO [src.utils:21] Saved query embeddings to /home/infres/zzhu-24/PRIM/VLM2Vec/experiments/public/exps/eval_cls_datasets/5Jan_Qwen3VL4b_rmv_28_7-Qwen/qwen-Qwen3-VL-4B-Instruct/checkpoint-4000/retrieval/layer_29/Country211_qry
[2026-01-18 16:45:15,517] INFO [src.utils:21] Encoding candidates...
Candidates for Country211 (rank 0):   0%|          | 0/9 [00:00<?, ?it/s]Candidates for Country211 (rank 0):  22%|██▏       | 2/9 [00:00<00:00, 11.34it/s]Candidates for Country211 (rank 0):  44%|████▍     | 4/9 [00:00<00:00, 12.55it/s]Candidates for Country211 (rank 0):  67%|██████▋   | 6/9 [00:00<00:00, 11.64it/s]Candidates for Country211 (rank 0):  89%|████████▉ | 8/9 [00:00<00:00, 12.34it/s]Candidates for Country211 (rank 0): 100%|██████████| 9/9 [00:00<00:00, 12.17it/s]
[2026-01-18 16:45:16,282] INFO [src.utils:21] Saved candidate embeddings to /home/infres/zzhu-24/PRIM/VLM2Vec/experiments/public/exps/eval_cls_datasets/5Jan_Qwen3VL4b_rmv_28_7-Qwen/qwen-Qwen3-VL-4B-Instruct/checkpoint-4000/retrieval/layer_29/Country211_tgt
[2026-01-18 16:45:16,282] INFO [src.utils:21] --- Scoring for layer 29 ---
Calculating scores for Country211: 0it [00:00, ?it/s]Calculating scores for Country211: 140it [00:00, 1398.35it/s]Calculating scores for Country211: 280it [00:00, 1388.06it/s]Calculating scores for Country211: 423it [00:00, 1404.83it/s]Calculating scores for Country211: 564it [00:00, 1404.38it/s]Calculating scores for Country211: 707it [00:00, 1411.20it/s]Calculating scores for Country211: 849it [00:00, 1408.32it/s]Calculating scores for Country211: 990it [00:00, 1406.77it/s]Calculating scores for Country211: 1000it [00:00, 1404.96it/s]
[2026-01-18 16:45:17,269] INFO [src.utils:21] Score of Country211:
[2026-01-18 16:45:17,269] INFO [src.utils:21] {'hit@1': '0.0430', 'hit@5': '0.1040', 'hit@10': '0.1770', 'ndcg_linear@1': '0.0430', 'ndcg_linear@5': '0.0731', 'ndcg_linear@10': '0.0967', 'ndcg_exponential@1': '0.0430', 'ndcg_exponential@5': '0.0731', 'ndcg_exponential@10': '0.0967', 'precision@1': '0.0430', 'precision@5': '0.0208', 'precision@10': '0.0177', 'recall@1': '0.0430', 'recall@5': '0.1040', 'recall@10': '0.1770', 'f1@1': '0.0430', 'f1@5': '0.0347', 'f1@10': '0.0322', 'map@1': '0.0430', 'map@5': '0.0631', 'map@10': '0.0727', 'mrr@1': '0.0430', 'mrr@5': '0.0631', 'mrr@10': '0.0727'}
[2026-01-18 16:45:17,269] INFO [src.utils:21] Outputting final score to: /home/infres/zzhu-24/PRIM/VLM2Vec/experiments/public/exps/eval_cls_datasets/5Jan_Qwen3VL4b_rmv_28_7-Qwen/qwen-Qwen3-VL-4B-Instruct/checkpoint-4000/retrieval/layer_29/Country211_score.json
